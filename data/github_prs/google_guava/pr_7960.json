{
  "id": 7960,
  "repository": "google/guava",
  "title": "inline calls to checked math operations (to use JDK APIs).",
  "body": "inline calls to checked math operations (to use JDK APIs).\n\nRELNOTES=n/a\n",
  "state": "closed",
  "merged": true,
  "merged_at": "2025-08-31T13:15:32+00:00",
  "created_at": "2025-08-31T12:51:31+00:00",
  "updated_at": "2025-08-31T13:15:33+00:00",
  "author": "copybara-service[bot]",
  "reviewers": [],
  "base_sha": "8d0b1e4bf83c6ef355d7a88b9be09d2a7e45102e",
  "head_sha": "d5f5391568e77b30dcb4e9a1fac842e14f9aeee5",
  "review_comments": [],
  "pr_comments": [],
  "files_changed": [
    {
      "filename": "android/guava/src/com/google/common/collect/CartesianList.java",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "patch": "@@ -19,7 +19,6 @@\n import com.google.common.annotations.GwtCompatible;\n import com.google.common.annotations.GwtIncompatible;\n import com.google.common.annotations.J2ktIncompatible;\n-import com.google.common.math.IntMath;\n import java.util.AbstractList;\n import java.util.List;\n import java.util.ListIterator;\n@@ -55,7 +54,7 @@ static <E> List<List<E>> create(List<? extends List<? extends E>> lists) {\n     axesSizeProduct[axes.size()] = 1;\n     try {\n       for (int i = axes.size() - 1; i >= 0; i--) {\n-        axesSizeProduct[i] = IntMath.checkedMultiply(axesSizeProduct[i + 1], axes.get(i).size());\n+        axesSizeProduct[i] = Math.multiplyExact(axesSizeProduct[i + 1], axes.get(i).size());\n       }\n     } catch (ArithmeticException e) {\n       throw new IllegalArgumentException("
    },
    {
      "filename": "android/guava/src/com/google/common/collect/ConcurrentHashMultiset.java",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "patch": "@@ -29,7 +29,6 @@\n import com.google.common.annotations.J2ktIncompatible;\n import com.google.common.annotations.VisibleForTesting;\n import com.google.common.collect.Serialization.FieldSetter;\n-import com.google.common.math.IntMath;\n import com.google.common.primitives.Ints;\n import com.google.errorprone.annotations.CanIgnoreReturnValue;\n import com.google.j2objc.annotations.WeakOuter;\n@@ -225,7 +224,7 @@ public int add(E element, int occurrences) {\n         int oldValue = existingCounter.get();\n         if (oldValue != 0) {\n           try {\n-            int newValue = IntMath.checkedAdd(oldValue, occurrences);\n+            int newValue = Math.addExact(oldValue, occurrences);\n             if (existingCounter.compareAndSet(oldValue, newValue)) {\n               // newValue can't == 0, so no need to check & remove\n               return oldValue;"
    },
    {
      "filename": "android/guava/src/com/google/common/collect/MinMaxPriorityQueue.java",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "patch": "@@ -29,7 +29,6 @@\n import com.google.common.annotations.GwtCompatible;\n import com.google.common.annotations.J2ktIncompatible;\n import com.google.common.annotations.VisibleForTesting;\n-import com.google.common.math.IntMath;\n import com.google.errorprone.annotations.CanIgnoreReturnValue;\n import com.google.j2objc.annotations.Weak;\n import com.google.j2objc.annotations.WeakOuter;\n@@ -968,7 +967,7 @@ private void growIfNeeded() {\n   private int calculateNewCapacity() {\n     int oldCapacity = queue.length;\n     int newCapacity =\n-        (oldCapacity < 64) ? (oldCapacity + 1) * 2 : IntMath.checkedMultiply(oldCapacity / 2, 3);\n+        (oldCapacity < 64) ? (oldCapacity + 1) * 2 : Math.multiplyExact(oldCapacity / 2, 3);\n     return capAtMaximumSize(newCapacity, maximumSize);\n   }\n "
    },
    {
      "filename": "android/guava/src/com/google/common/collect/TopKSelector.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "patch": "@@ -125,7 +125,7 @@ private TopKSelector(Comparator<? super T> comparator, int k) {\n     this.k = k;\n     checkArgument(k >= 0, \"k (%s) must be >= 0\", k);\n     checkArgument(k <= Integer.MAX_VALUE / 2, \"k (%s) must be <= Integer.MAX_VALUE / 2\", k);\n-    this.buffer = (T[]) new Object[IntMath.checkedMultiply(k, 2)];\n+    this.buffer = (T[]) new Object[Math.multiplyExact(k, 2)];\n     this.bufferSize = 0;\n     this.threshold = null;\n   }"
    },
    {
      "filename": "android/guava/src/com/google/common/hash/BloomFilter.java",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "patch": "@@ -24,7 +24,6 @@\n import com.google.common.base.Predicate;\n import com.google.common.hash.BloomFilterStrategies.LockFreeBitArray;\n import com.google.common.math.DoubleMath;\n-import com.google.common.math.LongMath;\n import com.google.common.primitives.SignedBytes;\n import com.google.common.primitives.UnsignedBytes;\n import com.google.errorprone.annotations.CanIgnoreReturnValue;\n@@ -629,7 +628,7 @@ public void writeTo(OutputStream out) throws IOException {\n       @SuppressWarnings(\"EnumOrdinal\")\n       Strategy strategy = BloomFilterStrategies.values()[strategyOrdinal];\n \n-      LockFreeBitArray dataArray = new LockFreeBitArray(LongMath.checkedMultiply(dataLength, 64L));\n+      LockFreeBitArray dataArray = new LockFreeBitArray(Math.multiplyExact(dataLength, 64L));\n       for (int i = 0; i < dataLength; i++) {\n         dataArray.putData(i, din.readLong());\n       }"
    },
    {
      "filename": "guava/src/com/google/common/collect/CartesianList.java",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "patch": "@@ -19,7 +19,6 @@\n import com.google.common.annotations.GwtCompatible;\n import com.google.common.annotations.GwtIncompatible;\n import com.google.common.annotations.J2ktIncompatible;\n-import com.google.common.math.IntMath;\n import java.util.AbstractList;\n import java.util.List;\n import java.util.ListIterator;\n@@ -55,7 +54,7 @@ static <E> List<List<E>> create(List<? extends List<? extends E>> lists) {\n     axesSizeProduct[axes.size()] = 1;\n     try {\n       for (int i = axes.size() - 1; i >= 0; i--) {\n-        axesSizeProduct[i] = IntMath.checkedMultiply(axesSizeProduct[i + 1], axes.get(i).size());\n+        axesSizeProduct[i] = Math.multiplyExact(axesSizeProduct[i + 1], axes.get(i).size());\n       }\n     } catch (ArithmeticException e) {\n       throw new IllegalArgumentException("
    },
    {
      "filename": "guava/src/com/google/common/collect/ConcurrentHashMultiset.java",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "patch": "@@ -29,7 +29,6 @@\n import com.google.common.annotations.J2ktIncompatible;\n import com.google.common.annotations.VisibleForTesting;\n import com.google.common.collect.Serialization.FieldSetter;\n-import com.google.common.math.IntMath;\n import com.google.common.primitives.Ints;\n import com.google.errorprone.annotations.CanIgnoreReturnValue;\n import com.google.j2objc.annotations.WeakOuter;\n@@ -225,7 +224,7 @@ public int add(E element, int occurrences) {\n         int oldValue = existingCounter.get();\n         if (oldValue != 0) {\n           try {\n-            int newValue = IntMath.checkedAdd(oldValue, occurrences);\n+            int newValue = Math.addExact(oldValue, occurrences);\n             if (existingCounter.compareAndSet(oldValue, newValue)) {\n               // newValue can't == 0, so no need to check & remove\n               return oldValue;"
    },
    {
      "filename": "guava/src/com/google/common/collect/MinMaxPriorityQueue.java",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "patch": "@@ -29,7 +29,6 @@\n import com.google.common.annotations.GwtCompatible;\n import com.google.common.annotations.J2ktIncompatible;\n import com.google.common.annotations.VisibleForTesting;\n-import com.google.common.math.IntMath;\n import com.google.errorprone.annotations.CanIgnoreReturnValue;\n import com.google.j2objc.annotations.Weak;\n import com.google.j2objc.annotations.WeakOuter;\n@@ -968,7 +967,7 @@ private void growIfNeeded() {\n   private int calculateNewCapacity() {\n     int oldCapacity = queue.length;\n     int newCapacity =\n-        (oldCapacity < 64) ? (oldCapacity + 1) * 2 : IntMath.checkedMultiply(oldCapacity / 2, 3);\n+        (oldCapacity < 64) ? (oldCapacity + 1) * 2 : Math.multiplyExact(oldCapacity / 2, 3);\n     return capAtMaximumSize(newCapacity, maximumSize);\n   }\n "
    },
    {
      "filename": "guava/src/com/google/common/collect/TopKSelector.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "patch": "@@ -126,7 +126,7 @@ private TopKSelector(Comparator<? super T> comparator, int k) {\n     this.k = k;\n     checkArgument(k >= 0, \"k (%s) must be >= 0\", k);\n     checkArgument(k <= Integer.MAX_VALUE / 2, \"k (%s) must be <= Integer.MAX_VALUE / 2\", k);\n-    this.buffer = (T[]) new Object[IntMath.checkedMultiply(k, 2)];\n+    this.buffer = (T[]) new Object[Math.multiplyExact(k, 2)];\n     this.bufferSize = 0;\n     this.threshold = null;\n   }"
    },
    {
      "filename": "guava/src/com/google/common/hash/BloomFilter.java",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "patch": "@@ -24,7 +24,6 @@\n import com.google.common.base.Predicate;\n import com.google.common.hash.BloomFilterStrategies.LockFreeBitArray;\n import com.google.common.math.DoubleMath;\n-import com.google.common.math.LongMath;\n import com.google.common.primitives.SignedBytes;\n import com.google.common.primitives.UnsignedBytes;\n import com.google.errorprone.annotations.CanIgnoreReturnValue;\n@@ -639,7 +638,7 @@ public void writeTo(OutputStream out) throws IOException {\n       @SuppressWarnings(\"EnumOrdinal\")\n       Strategy strategy = BloomFilterStrategies.values()[strategyOrdinal];\n \n-      LockFreeBitArray dataArray = new LockFreeBitArray(LongMath.checkedMultiply(dataLength, 64L));\n+      LockFreeBitArray dataArray = new LockFreeBitArray(Math.multiplyExact(dataLength, 64L));\n       for (int i = 0; i < dataLength; i++) {\n         dataArray.putData(i, din.readLong());\n       }"
    }
  ],
  "diff": "diff --git a/android/guava/src/com/google/common/collect/CartesianList.java b/android/guava/src/com/google/common/collect/CartesianList.java\nindex 8150370afd04..7c5d2df446dd 100644\n--- a/android/guava/src/com/google/common/collect/CartesianList.java\n+++ b/android/guava/src/com/google/common/collect/CartesianList.java\n@@ -19,7 +19,6 @@\n import com.google.common.annotations.GwtCompatible;\n import com.google.common.annotations.GwtIncompatible;\n import com.google.common.annotations.J2ktIncompatible;\n-import com.google.common.math.IntMath;\n import java.util.AbstractList;\n import java.util.List;\n import java.util.ListIterator;\n@@ -55,7 +54,7 @@ static <E> List<List<E>> create(List<? extends List<? extends E>> lists) {\n     axesSizeProduct[axes.size()] = 1;\n     try {\n       for (int i = axes.size() - 1; i >= 0; i--) {\n-        axesSizeProduct[i] = IntMath.checkedMultiply(axesSizeProduct[i + 1], axes.get(i).size());\n+        axesSizeProduct[i] = Math.multiplyExact(axesSizeProduct[i + 1], axes.get(i).size());\n       }\n     } catch (ArithmeticException e) {\n       throw new IllegalArgumentException(\ndiff --git a/android/guava/src/com/google/common/collect/ConcurrentHashMultiset.java b/android/guava/src/com/google/common/collect/ConcurrentHashMultiset.java\nindex ac1d0e66f8ed..6242c605e799 100644\n--- a/android/guava/src/com/google/common/collect/ConcurrentHashMultiset.java\n+++ b/android/guava/src/com/google/common/collect/ConcurrentHashMultiset.java\n@@ -29,7 +29,6 @@\n import com.google.common.annotations.J2ktIncompatible;\n import com.google.common.annotations.VisibleForTesting;\n import com.google.common.collect.Serialization.FieldSetter;\n-import com.google.common.math.IntMath;\n import com.google.common.primitives.Ints;\n import com.google.errorprone.annotations.CanIgnoreReturnValue;\n import com.google.j2objc.annotations.WeakOuter;\n@@ -225,7 +224,7 @@ public int add(E element, int occurrences) {\n         int oldValue = existingCounter.get();\n         if (oldValue != 0) {\n           try {\n-            int newValue = IntMath.checkedAdd(oldValue, occurrences);\n+            int newValue = Math.addExact(oldValue, occurrences);\n             if (existingCounter.compareAndSet(oldValue, newValue)) {\n               // newValue can't == 0, so no need to check & remove\n               return oldValue;\ndiff --git a/android/guava/src/com/google/common/collect/MinMaxPriorityQueue.java b/android/guava/src/com/google/common/collect/MinMaxPriorityQueue.java\nindex 661d202adc6b..6e13b5771ce5 100644\n--- a/android/guava/src/com/google/common/collect/MinMaxPriorityQueue.java\n+++ b/android/guava/src/com/google/common/collect/MinMaxPriorityQueue.java\n@@ -29,7 +29,6 @@\n import com.google.common.annotations.GwtCompatible;\n import com.google.common.annotations.J2ktIncompatible;\n import com.google.common.annotations.VisibleForTesting;\n-import com.google.common.math.IntMath;\n import com.google.errorprone.annotations.CanIgnoreReturnValue;\n import com.google.j2objc.annotations.Weak;\n import com.google.j2objc.annotations.WeakOuter;\n@@ -968,7 +967,7 @@ private void growIfNeeded() {\n   private int calculateNewCapacity() {\n     int oldCapacity = queue.length;\n     int newCapacity =\n-        (oldCapacity < 64) ? (oldCapacity + 1) * 2 : IntMath.checkedMultiply(oldCapacity / 2, 3);\n+        (oldCapacity < 64) ? (oldCapacity + 1) * 2 : Math.multiplyExact(oldCapacity / 2, 3);\n     return capAtMaximumSize(newCapacity, maximumSize);\n   }\n \ndiff --git a/android/guava/src/com/google/common/collect/TopKSelector.java b/android/guava/src/com/google/common/collect/TopKSelector.java\nindex 7da3772492d6..29fadc397d8b 100644\n--- a/android/guava/src/com/google/common/collect/TopKSelector.java\n+++ b/android/guava/src/com/google/common/collect/TopKSelector.java\n@@ -125,7 +125,7 @@ private TopKSelector(Comparator<? super T> comparator, int k) {\n     this.k = k;\n     checkArgument(k >= 0, \"k (%s) must be >= 0\", k);\n     checkArgument(k <= Integer.MAX_VALUE / 2, \"k (%s) must be <= Integer.MAX_VALUE / 2\", k);\n-    this.buffer = (T[]) new Object[IntMath.checkedMultiply(k, 2)];\n+    this.buffer = (T[]) new Object[Math.multiplyExact(k, 2)];\n     this.bufferSize = 0;\n     this.threshold = null;\n   }\ndiff --git a/android/guava/src/com/google/common/hash/BloomFilter.java b/android/guava/src/com/google/common/hash/BloomFilter.java\nindex d41e3e61ee51..dc8163fe785c 100644\n--- a/android/guava/src/com/google/common/hash/BloomFilter.java\n+++ b/android/guava/src/com/google/common/hash/BloomFilter.java\n@@ -24,7 +24,6 @@\n import com.google.common.base.Predicate;\n import com.google.common.hash.BloomFilterStrategies.LockFreeBitArray;\n import com.google.common.math.DoubleMath;\n-import com.google.common.math.LongMath;\n import com.google.common.primitives.SignedBytes;\n import com.google.common.primitives.UnsignedBytes;\n import com.google.errorprone.annotations.CanIgnoreReturnValue;\n@@ -629,7 +628,7 @@ public void writeTo(OutputStream out) throws IOException {\n       @SuppressWarnings(\"EnumOrdinal\")\n       Strategy strategy = BloomFilterStrategies.values()[strategyOrdinal];\n \n-      LockFreeBitArray dataArray = new LockFreeBitArray(LongMath.checkedMultiply(dataLength, 64L));\n+      LockFreeBitArray dataArray = new LockFreeBitArray(Math.multiplyExact(dataLength, 64L));\n       for (int i = 0; i < dataLength; i++) {\n         dataArray.putData(i, din.readLong());\n       }\ndiff --git a/guava/src/com/google/common/collect/CartesianList.java b/guava/src/com/google/common/collect/CartesianList.java\nindex 8150370afd04..7c5d2df446dd 100644\n--- a/guava/src/com/google/common/collect/CartesianList.java\n+++ b/guava/src/com/google/common/collect/CartesianList.java\n@@ -19,7 +19,6 @@\n import com.google.common.annotations.GwtCompatible;\n import com.google.common.annotations.GwtIncompatible;\n import com.google.common.annotations.J2ktIncompatible;\n-import com.google.common.math.IntMath;\n import java.util.AbstractList;\n import java.util.List;\n import java.util.ListIterator;\n@@ -55,7 +54,7 @@ static <E> List<List<E>> create(List<? extends List<? extends E>> lists) {\n     axesSizeProduct[axes.size()] = 1;\n     try {\n       for (int i = axes.size() - 1; i >= 0; i--) {\n-        axesSizeProduct[i] = IntMath.checkedMultiply(axesSizeProduct[i + 1], axes.get(i).size());\n+        axesSizeProduct[i] = Math.multiplyExact(axesSizeProduct[i + 1], axes.get(i).size());\n       }\n     } catch (ArithmeticException e) {\n       throw new IllegalArgumentException(\ndiff --git a/guava/src/com/google/common/collect/ConcurrentHashMultiset.java b/guava/src/com/google/common/collect/ConcurrentHashMultiset.java\nindex ac1d0e66f8ed..6242c605e799 100644\n--- a/guava/src/com/google/common/collect/ConcurrentHashMultiset.java\n+++ b/guava/src/com/google/common/collect/ConcurrentHashMultiset.java\n@@ -29,7 +29,6 @@\n import com.google.common.annotations.J2ktIncompatible;\n import com.google.common.annotations.VisibleForTesting;\n import com.google.common.collect.Serialization.FieldSetter;\n-import com.google.common.math.IntMath;\n import com.google.common.primitives.Ints;\n import com.google.errorprone.annotations.CanIgnoreReturnValue;\n import com.google.j2objc.annotations.WeakOuter;\n@@ -225,7 +224,7 @@ public int add(E element, int occurrences) {\n         int oldValue = existingCounter.get();\n         if (oldValue != 0) {\n           try {\n-            int newValue = IntMath.checkedAdd(oldValue, occurrences);\n+            int newValue = Math.addExact(oldValue, occurrences);\n             if (existingCounter.compareAndSet(oldValue, newValue)) {\n               // newValue can't == 0, so no need to check & remove\n               return oldValue;\ndiff --git a/guava/src/com/google/common/collect/MinMaxPriorityQueue.java b/guava/src/com/google/common/collect/MinMaxPriorityQueue.java\nindex 661d202adc6b..6e13b5771ce5 100644\n--- a/guava/src/com/google/common/collect/MinMaxPriorityQueue.java\n+++ b/guava/src/com/google/common/collect/MinMaxPriorityQueue.java\n@@ -29,7 +29,6 @@\n import com.google.common.annotations.GwtCompatible;\n import com.google.common.annotations.J2ktIncompatible;\n import com.google.common.annotations.VisibleForTesting;\n-import com.google.common.math.IntMath;\n import com.google.errorprone.annotations.CanIgnoreReturnValue;\n import com.google.j2objc.annotations.Weak;\n import com.google.j2objc.annotations.WeakOuter;\n@@ -968,7 +967,7 @@ private void growIfNeeded() {\n   private int calculateNewCapacity() {\n     int oldCapacity = queue.length;\n     int newCapacity =\n-        (oldCapacity < 64) ? (oldCapacity + 1) * 2 : IntMath.checkedMultiply(oldCapacity / 2, 3);\n+        (oldCapacity < 64) ? (oldCapacity + 1) * 2 : Math.multiplyExact(oldCapacity / 2, 3);\n     return capAtMaximumSize(newCapacity, maximumSize);\n   }\n \ndiff --git a/guava/src/com/google/common/collect/TopKSelector.java b/guava/src/com/google/common/collect/TopKSelector.java\nindex a61799eb9ed1..43ff655c1337 100644\n--- a/guava/src/com/google/common/collect/TopKSelector.java\n+++ b/guava/src/com/google/common/collect/TopKSelector.java\n@@ -126,7 +126,7 @@ private TopKSelector(Comparator<? super T> comparator, int k) {\n     this.k = k;\n     checkArgument(k >= 0, \"k (%s) must be >= 0\", k);\n     checkArgument(k <= Integer.MAX_VALUE / 2, \"k (%s) must be <= Integer.MAX_VALUE / 2\", k);\n-    this.buffer = (T[]) new Object[IntMath.checkedMultiply(k, 2)];\n+    this.buffer = (T[]) new Object[Math.multiplyExact(k, 2)];\n     this.bufferSize = 0;\n     this.threshold = null;\n   }\ndiff --git a/guava/src/com/google/common/hash/BloomFilter.java b/guava/src/com/google/common/hash/BloomFilter.java\nindex 1f0cced2f6a5..346c37db7c45 100644\n--- a/guava/src/com/google/common/hash/BloomFilter.java\n+++ b/guava/src/com/google/common/hash/BloomFilter.java\n@@ -24,7 +24,6 @@\n import com.google.common.base.Predicate;\n import com.google.common.hash.BloomFilterStrategies.LockFreeBitArray;\n import com.google.common.math.DoubleMath;\n-import com.google.common.math.LongMath;\n import com.google.common.primitives.SignedBytes;\n import com.google.common.primitives.UnsignedBytes;\n import com.google.errorprone.annotations.CanIgnoreReturnValue;\n@@ -639,7 +638,7 @@ public void writeTo(OutputStream out) throws IOException {\n       @SuppressWarnings(\"EnumOrdinal\")\n       Strategy strategy = BloomFilterStrategies.values()[strategyOrdinal];\n \n-      LockFreeBitArray dataArray = new LockFreeBitArray(LongMath.checkedMultiply(dataLength, 64L));\n+      LockFreeBitArray dataArray = new LockFreeBitArray(Math.multiplyExact(dataLength, 64L));\n       for (int i = 0; i < dataLength; i++) {\n         dataArray.putData(i, din.readLong());\n       }\n",
  "additions": 10,
  "deletions": 18,
  "changed_files": 10,
  "url": "https://github.com/google/guava/pull/7960",
  "mined_at": "2025-10-25T13:06:26.744143"
}
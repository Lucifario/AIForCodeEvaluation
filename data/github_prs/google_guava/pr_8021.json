{
  "id": 8021,
  "repository": "google/guava",
  "title": "Use `Reflection.newProxy` and a lambda.",
  "body": "Use `Reflection.newProxy` and a lambda.\n\nRELNOTES=n/a\n",
  "state": "closed",
  "merged": true,
  "merged_at": "2025-09-24T22:52:24+00:00",
  "created_at": "2025-09-24T22:25:50+00:00",
  "updated_at": "2025-09-24T22:52:24+00:00",
  "author": "copybara-service[bot]",
  "reviewers": [],
  "base_sha": "a68d5843e1f12c1aef5fdb02afe8b77821f2d207",
  "head_sha": "d7240c0eedbef92ca40377e864a77a1e30e91474",
  "review_comments": [],
  "pr_comments": [],
  "files_changed": [
    {
      "filename": "android/guava-tests/test/com/google/common/collect/MultimapsCollectionTest.java",
      "status": "modified",
      "additions": 5,
      "deletions": 12,
      "changes": 17,
      "patch": "@@ -30,7 +30,7 @@\n import static com.google.common.collect.testing.google.MultisetElementSetTester.getElementSetDuplicateInitializingMethods;\n import static com.google.common.collect.testing.google.MultisetIteratorTester.getIteratorDuplicateInitializingMethods;\n import static com.google.common.collect.testing.google.MultisetRemoveTester.getRemoveDuplicateInitializingMethods;\n-import static java.lang.reflect.Proxy.newProxyInstance;\n+import static com.google.common.reflect.Reflection.newProxy;\n \n import com.google.common.annotations.GwtIncompatible;\n import com.google.common.base.Ascii;\n@@ -57,8 +57,6 @@\n import com.google.common.collect.testing.google.TestSetMultimapGenerator;\n import com.google.common.collect.testing.google.TestStringListMultimapGenerator;\n import com.google.common.collect.testing.google.TestStringMultisetGenerator;\n-import java.lang.reflect.InvocationHandler;\n-import java.lang.reflect.Method;\n import java.util.Collection;\n import java.util.HashMap;\n import java.util.List;\n@@ -150,15 +148,10 @@ static <K, V> PopulatableMapAsMultimap<K, V> create() {\n       this.map = new HashMap<>();\n       this.unusableDelegate =\n           (SetMultimap<K, V>)\n-              newProxyInstance(\n-                  SetMultimap.class.getClassLoader(),\n-                  new Class<?>[] {SetMultimap.class},\n-                  new InvocationHandler() {\n-                    @Override\n-                    public Object invoke(Object proxy, Method method, Object[] args)\n-                        throws Throwable {\n-                      throw new UnsupportedOperationException();\n-                    }\n+              newProxy(\n+                  SetMultimap.class,\n+                  (proxy, method, args) -> {\n+                    throw new UnsupportedOperationException();\n                   });\n     }\n "
    },
    {
      "filename": "guava-tests/test/com/google/common/collect/MultimapsCollectionTest.java",
      "status": "modified",
      "additions": 5,
      "deletions": 12,
      "changes": 17,
      "patch": "@@ -31,7 +31,7 @@\n import static com.google.common.collect.testing.google.MultisetForEachEntryTester.getForEachEntryDuplicateInitializingMethods;\n import static com.google.common.collect.testing.google.MultisetIteratorTester.getIteratorDuplicateInitializingMethods;\n import static com.google.common.collect.testing.google.MultisetRemoveTester.getRemoveDuplicateInitializingMethods;\n-import static java.lang.reflect.Proxy.newProxyInstance;\n+import static com.google.common.reflect.Reflection.newProxy;\n \n import com.google.common.annotations.GwtIncompatible;\n import com.google.common.base.Ascii;\n@@ -58,8 +58,6 @@\n import com.google.common.collect.testing.google.TestSetMultimapGenerator;\n import com.google.common.collect.testing.google.TestStringListMultimapGenerator;\n import com.google.common.collect.testing.google.TestStringMultisetGenerator;\n-import java.lang.reflect.InvocationHandler;\n-import java.lang.reflect.Method;\n import java.util.Collection;\n import java.util.HashMap;\n import java.util.List;\n@@ -151,15 +149,10 @@ static <K, V> PopulatableMapAsMultimap<K, V> create() {\n       this.map = new HashMap<>();\n       this.unusableDelegate =\n           (SetMultimap<K, V>)\n-              newProxyInstance(\n-                  SetMultimap.class.getClassLoader(),\n-                  new Class<?>[] {SetMultimap.class},\n-                  new InvocationHandler() {\n-                    @Override\n-                    public Object invoke(Object proxy, Method method, Object[] args)\n-                        throws Throwable {\n-                      throw new UnsupportedOperationException();\n-                    }\n+              newProxy(\n+                  SetMultimap.class,\n+                  (proxy, method, args) -> {\n+                    throw new UnsupportedOperationException();\n                   });\n     }\n "
    }
  ],
  "diff": "diff --git a/android/guava-tests/test/com/google/common/collect/MultimapsCollectionTest.java b/android/guava-tests/test/com/google/common/collect/MultimapsCollectionTest.java\nindex 439aab2f7f3c..882abdd8e131 100644\n--- a/android/guava-tests/test/com/google/common/collect/MultimapsCollectionTest.java\n+++ b/android/guava-tests/test/com/google/common/collect/MultimapsCollectionTest.java\n@@ -30,7 +30,7 @@\n import static com.google.common.collect.testing.google.MultisetElementSetTester.getElementSetDuplicateInitializingMethods;\n import static com.google.common.collect.testing.google.MultisetIteratorTester.getIteratorDuplicateInitializingMethods;\n import static com.google.common.collect.testing.google.MultisetRemoveTester.getRemoveDuplicateInitializingMethods;\n-import static java.lang.reflect.Proxy.newProxyInstance;\n+import static com.google.common.reflect.Reflection.newProxy;\n \n import com.google.common.annotations.GwtIncompatible;\n import com.google.common.base.Ascii;\n@@ -57,8 +57,6 @@\n import com.google.common.collect.testing.google.TestSetMultimapGenerator;\n import com.google.common.collect.testing.google.TestStringListMultimapGenerator;\n import com.google.common.collect.testing.google.TestStringMultisetGenerator;\n-import java.lang.reflect.InvocationHandler;\n-import java.lang.reflect.Method;\n import java.util.Collection;\n import java.util.HashMap;\n import java.util.List;\n@@ -150,15 +148,10 @@ static <K, V> PopulatableMapAsMultimap<K, V> create() {\n       this.map = new HashMap<>();\n       this.unusableDelegate =\n           (SetMultimap<K, V>)\n-              newProxyInstance(\n-                  SetMultimap.class.getClassLoader(),\n-                  new Class<?>[] {SetMultimap.class},\n-                  new InvocationHandler() {\n-                    @Override\n-                    public Object invoke(Object proxy, Method method, Object[] args)\n-                        throws Throwable {\n-                      throw new UnsupportedOperationException();\n-                    }\n+              newProxy(\n+                  SetMultimap.class,\n+                  (proxy, method, args) -> {\n+                    throw new UnsupportedOperationException();\n                   });\n     }\n \ndiff --git a/guava-tests/test/com/google/common/collect/MultimapsCollectionTest.java b/guava-tests/test/com/google/common/collect/MultimapsCollectionTest.java\nindex 43b0e93083af..6b683e13633d 100644\n--- a/guava-tests/test/com/google/common/collect/MultimapsCollectionTest.java\n+++ b/guava-tests/test/com/google/common/collect/MultimapsCollectionTest.java\n@@ -31,7 +31,7 @@\n import static com.google.common.collect.testing.google.MultisetForEachEntryTester.getForEachEntryDuplicateInitializingMethods;\n import static com.google.common.collect.testing.google.MultisetIteratorTester.getIteratorDuplicateInitializingMethods;\n import static com.google.common.collect.testing.google.MultisetRemoveTester.getRemoveDuplicateInitializingMethods;\n-import static java.lang.reflect.Proxy.newProxyInstance;\n+import static com.google.common.reflect.Reflection.newProxy;\n \n import com.google.common.annotations.GwtIncompatible;\n import com.google.common.base.Ascii;\n@@ -58,8 +58,6 @@\n import com.google.common.collect.testing.google.TestSetMultimapGenerator;\n import com.google.common.collect.testing.google.TestStringListMultimapGenerator;\n import com.google.common.collect.testing.google.TestStringMultisetGenerator;\n-import java.lang.reflect.InvocationHandler;\n-import java.lang.reflect.Method;\n import java.util.Collection;\n import java.util.HashMap;\n import java.util.List;\n@@ -151,15 +149,10 @@ static <K, V> PopulatableMapAsMultimap<K, V> create() {\n       this.map = new HashMap<>();\n       this.unusableDelegate =\n           (SetMultimap<K, V>)\n-              newProxyInstance(\n-                  SetMultimap.class.getClassLoader(),\n-                  new Class<?>[] {SetMultimap.class},\n-                  new InvocationHandler() {\n-                    @Override\n-                    public Object invoke(Object proxy, Method method, Object[] args)\n-                        throws Throwable {\n-                      throw new UnsupportedOperationException();\n-                    }\n+              newProxy(\n+                  SetMultimap.class,\n+                  (proxy, method, args) -> {\n+                    throw new UnsupportedOperationException();\n                   });\n     }\n \n",
  "additions": 10,
  "deletions": 24,
  "changed_files": 2,
  "url": "https://github.com/google/guava/pull/8021",
  "mined_at": "2025-10-25T12:55:23.740778"
}
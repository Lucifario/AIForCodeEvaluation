{
  "id": 8032,
  "repository": "google/guava",
  "title": "Use `catch` blocks for `ReflectiveOperationException` (or a union type with that erasure).",
  "body": "Use `catch` blocks for `ReflectiveOperationException` (or a union type with that erasure).\n\nThis has been possible since our `minSdkVersion` reached 19, but I'd missed it. Perhaps I had even looked for cases like this but had searched for _yet another_ bug about it, rather than one of the two different bugs that I cited in this same file? :)\n\nRELNOTES=n/a\n",
  "state": "closed",
  "merged": true,
  "merged_at": "2025-09-29T18:50:20+00:00",
  "created_at": "2025-09-29T18:25:11+00:00",
  "updated_at": "2025-09-29T18:50:20+00:00",
  "author": "copybara-service[bot]",
  "reviewers": [],
  "base_sha": "ae5e4d6f12ba92f90ace3f3d8ade76e0a52d8c24",
  "head_sha": "a82bb6dd122b38e10fcfcacf3e8cdc08b770ce59",
  "review_comments": [],
  "pr_comments": [],
  "files_changed": [
    {
      "filename": "android/guava/src/com/google/common/io/TempFileCreator.java",
      "status": "modified",
      "additions": 2,
      "deletions": 18,
      "changes": 20,
      "patch": "@@ -82,18 +82,9 @@ private static TempFileCreator pickSecureCreator() {\n       if (version < jellyBean) {\n         return new ThrowingCreator();\n       }\n-\n-      // Don't merge these catch() blocks, let alone use ReflectiveOperationException directly:\n-      // b/65343391\n-    } catch (NoSuchFieldException e) {\n-      // The JELLY_BEAN field doesn't exist because we're running on a version before Jelly Bean :)\n-      return new ThrowingCreator();\n-    } catch (ClassNotFoundException e) {\n+    } catch (ReflectiveOperationException e) {\n       // Should be impossible, but we want to return *something* so that class init succeeds.\n       return new ThrowingCreator();\n-    } catch (IllegalAccessException e) {\n-      // ditto\n-      return new ThrowingCreator();\n     }\n \n     // Android isolates apps' temporary directories since Jelly Bean:\n@@ -242,14 +233,7 @@ private static String getUsername() {\n       } catch (InvocationTargetException e) {\n         throwIfUnchecked(e.getCause()); // in case it's an Error or something\n         return fromSystemProperty; // should be impossible\n-      } catch (NoSuchMethodException shouldBeImpossible) {\n-        return fromSystemProperty;\n-      } catch (IllegalAccessException shouldBeImpossible) {\n-        /*\n-         * We don't merge these into `catch (ReflectiveOperationException ...)` or an equivalent\n-         * multicatch because ReflectiveOperationException isn't available under Android:\n-         * b/124188803\n-         */\n+      } catch (NoSuchMethodException | IllegalAccessException shouldBeImpossible) {\n         return fromSystemProperty;\n       }\n     }"
    },
    {
      "filename": "guava/src/com/google/common/io/TempFileCreator.java",
      "status": "modified",
      "additions": 2,
      "deletions": 18,
      "changes": 20,
      "patch": "@@ -82,18 +82,9 @@ private static TempFileCreator pickSecureCreator() {\n       if (version < jellyBean) {\n         return new ThrowingCreator();\n       }\n-\n-      // Don't merge these catch() blocks, let alone use ReflectiveOperationException directly:\n-      // b/65343391\n-    } catch (NoSuchFieldException e) {\n-      // The JELLY_BEAN field doesn't exist because we're running on a version before Jelly Bean :)\n-      return new ThrowingCreator();\n-    } catch (ClassNotFoundException e) {\n+    } catch (ReflectiveOperationException e) {\n       // Should be impossible, but we want to return *something* so that class init succeeds.\n       return new ThrowingCreator();\n-    } catch (IllegalAccessException e) {\n-      // ditto\n-      return new ThrowingCreator();\n     }\n \n     // Android isolates apps' temporary directories since Jelly Bean:\n@@ -242,14 +233,7 @@ private static String getUsername() {\n       } catch (InvocationTargetException e) {\n         throwIfUnchecked(e.getCause()); // in case it's an Error or something\n         return fromSystemProperty; // should be impossible\n-      } catch (NoSuchMethodException shouldBeImpossible) {\n-        return fromSystemProperty;\n-      } catch (IllegalAccessException shouldBeImpossible) {\n-        /*\n-         * We don't merge these into `catch (ReflectiveOperationException ...)` or an equivalent\n-         * multicatch because ReflectiveOperationException isn't available under Android:\n-         * b/124188803\n-         */\n+      } catch (NoSuchMethodException | IllegalAccessException shouldBeImpossible) {\n         return fromSystemProperty;\n       }\n     }"
    }
  ],
  "diff": "diff --git a/android/guava/src/com/google/common/io/TempFileCreator.java b/android/guava/src/com/google/common/io/TempFileCreator.java\nindex 6a65e39d2572..6089cffece64 100644\n--- a/android/guava/src/com/google/common/io/TempFileCreator.java\n+++ b/android/guava/src/com/google/common/io/TempFileCreator.java\n@@ -82,18 +82,9 @@ private static TempFileCreator pickSecureCreator() {\n       if (version < jellyBean) {\n         return new ThrowingCreator();\n       }\n-\n-      // Don't merge these catch() blocks, let alone use ReflectiveOperationException directly:\n-      // b/65343391\n-    } catch (NoSuchFieldException e) {\n-      // The JELLY_BEAN field doesn't exist because we're running on a version before Jelly Bean :)\n-      return new ThrowingCreator();\n-    } catch (ClassNotFoundException e) {\n+    } catch (ReflectiveOperationException e) {\n       // Should be impossible, but we want to return *something* so that class init succeeds.\n       return new ThrowingCreator();\n-    } catch (IllegalAccessException e) {\n-      // ditto\n-      return new ThrowingCreator();\n     }\n \n     // Android isolates apps' temporary directories since Jelly Bean:\n@@ -242,14 +233,7 @@ private static String getUsername() {\n       } catch (InvocationTargetException e) {\n         throwIfUnchecked(e.getCause()); // in case it's an Error or something\n         return fromSystemProperty; // should be impossible\n-      } catch (NoSuchMethodException shouldBeImpossible) {\n-        return fromSystemProperty;\n-      } catch (IllegalAccessException shouldBeImpossible) {\n-        /*\n-         * We don't merge these into `catch (ReflectiveOperationException ...)` or an equivalent\n-         * multicatch because ReflectiveOperationException isn't available under Android:\n-         * b/124188803\n-         */\n+      } catch (NoSuchMethodException | IllegalAccessException shouldBeImpossible) {\n         return fromSystemProperty;\n       }\n     }\ndiff --git a/guava/src/com/google/common/io/TempFileCreator.java b/guava/src/com/google/common/io/TempFileCreator.java\nindex 6a65e39d2572..6089cffece64 100644\n--- a/guava/src/com/google/common/io/TempFileCreator.java\n+++ b/guava/src/com/google/common/io/TempFileCreator.java\n@@ -82,18 +82,9 @@ private static TempFileCreator pickSecureCreator() {\n       if (version < jellyBean) {\n         return new ThrowingCreator();\n       }\n-\n-      // Don't merge these catch() blocks, let alone use ReflectiveOperationException directly:\n-      // b/65343391\n-    } catch (NoSuchFieldException e) {\n-      // The JELLY_BEAN field doesn't exist because we're running on a version before Jelly Bean :)\n-      return new ThrowingCreator();\n-    } catch (ClassNotFoundException e) {\n+    } catch (ReflectiveOperationException e) {\n       // Should be impossible, but we want to return *something* so that class init succeeds.\n       return new ThrowingCreator();\n-    } catch (IllegalAccessException e) {\n-      // ditto\n-      return new ThrowingCreator();\n     }\n \n     // Android isolates apps' temporary directories since Jelly Bean:\n@@ -242,14 +233,7 @@ private static String getUsername() {\n       } catch (InvocationTargetException e) {\n         throwIfUnchecked(e.getCause()); // in case it's an Error or something\n         return fromSystemProperty; // should be impossible\n-      } catch (NoSuchMethodException shouldBeImpossible) {\n-        return fromSystemProperty;\n-      } catch (IllegalAccessException shouldBeImpossible) {\n-        /*\n-         * We don't merge these into `catch (ReflectiveOperationException ...)` or an equivalent\n-         * multicatch because ReflectiveOperationException isn't available under Android:\n-         * b/124188803\n-         */\n+      } catch (NoSuchMethodException | IllegalAccessException shouldBeImpossible) {\n         return fromSystemProperty;\n       }\n     }\n",
  "additions": 4,
  "deletions": 36,
  "changed_files": 2,
  "url": "https://github.com/google/guava/pull/8032",
  "mined_at": "2025-10-25T12:54:06.010631"
}
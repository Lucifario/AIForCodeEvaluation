{
  "id": 8025,
  "repository": "google/guava",
  "title": "Remove handling of obsolete Android versions whose temporary directory is `/sdcard`.",
  "body": "Remove handling of obsolete Android versions whose temporary directory is `/sdcard`.\n\nThis handling was added in https://github.com/google/guava/commit/feb83a1c8fd2e7670b244d5afd23cba5aca43284. It became unnecessary once [our minSdkVersion hit 16](https://github.com/google/guava/issues/4011#issuecomment-770020802), as it did years ago.\n\n(I was reminded of this while reviewing https://github.com/google/guava/pull/7986 for https://github.com/google/guava/issues/5756.)\n\nRELNOTES=n/a\n",
  "state": "closed",
  "merged": true,
  "merged_at": "2025-09-25T19:16:59+00:00",
  "created_at": "2025-09-25T18:51:17+00:00",
  "updated_at": "2025-09-25T19:17:00+00:00",
  "author": "copybara-service[bot]",
  "reviewers": [],
  "base_sha": "9a406e7f461c27d141eb765d7992e767ee13427f",
  "head_sha": "a84b5f3c319e7573909d6977755bf4ebe36368b2",
  "review_comments": [],
  "pr_comments": [],
  "files_changed": [
    {
      "filename": "android/guava-tests/test/com/google/common/io/FileBackedOutputStreamTest.java",
      "status": "modified",
      "additions": 0,
      "deletions": 9,
      "changes": 9,
      "patch": "@@ -16,7 +16,6 @@\n \n package com.google.common.io;\n \n-import static com.google.common.base.StandardSystemProperty.JAVA_IO_TMPDIR;\n import static com.google.common.base.StandardSystemProperty.OS_NAME;\n import static com.google.common.truth.Truth.assertThat;\n import static java.lang.Math.min;\n@@ -73,10 +72,6 @@ private void testThreshold(\n \n     // Write data to go over the threshold\n     if (chunk2 > 0) {\n-      if (JAVA_IO_TMPDIR.value().equals(\"/sdcard\")) {\n-        assertThrows(IOException.class, () -> write(out, data, chunk1, chunk2, singleByte));\n-        return;\n-      }\n       write(out, data, chunk1, chunk2, singleByte);\n       file = out.getFile();\n       assertEquals(dataSize, file.length());\n@@ -132,10 +127,6 @@ public void testWriteErrorAfterClose() throws Exception {\n     FileBackedOutputStream out = new FileBackedOutputStream(50);\n     ByteSource source = out.asByteSource();\n \n-    if (JAVA_IO_TMPDIR.value().equals(\"/sdcard\")) {\n-      assertThrows(IOException.class, () -> out.write(data));\n-      return;\n-    }\n     out.write(data);\n     assertTrue(Arrays.equals(data, source.read()));\n "
    },
    {
      "filename": "android/guava-tests/test/com/google/common/io/FilesCreateTempDirTest.java",
      "status": "modified",
      "additions": 0,
      "deletions": 6,
      "changes": 6,
      "patch": "@@ -16,14 +16,12 @@\n \n package com.google.common.io;\n \n-import static com.google.common.base.StandardSystemProperty.JAVA_IO_TMPDIR;\n import static com.google.common.base.StandardSystemProperty.JAVA_SPECIFICATION_VERSION;\n import static com.google.common.base.StandardSystemProperty.OS_NAME;\n import static com.google.common.truth.Truth.assertThat;\n import static java.nio.file.attribute.PosixFilePermission.OWNER_EXECUTE;\n import static java.nio.file.attribute.PosixFilePermission.OWNER_READ;\n import static java.nio.file.attribute.PosixFilePermission.OWNER_WRITE;\n-import static org.junit.Assert.assertThrows;\n \n import java.io.File;\n import java.io.IOException;\n@@ -42,10 +40,6 @@\n @NullUnmarked\n public class FilesCreateTempDirTest extends TestCase {\n   public void testCreateTempDir() throws IOException {\n-    if (JAVA_IO_TMPDIR.value().equals(\"/sdcard\")) {\n-      assertThrows(IllegalStateException.class, Files::createTempDir);\n-      return;\n-    }\n     File temp = Files.createTempDir();\n     try {\n       assertThat(temp.exists()).isTrue();"
    },
    {
      "filename": "guava-tests/test/com/google/common/io/FileBackedOutputStreamTest.java",
      "status": "modified",
      "additions": 0,
      "deletions": 9,
      "changes": 9,
      "patch": "@@ -16,7 +16,6 @@\n \n package com.google.common.io;\n \n-import static com.google.common.base.StandardSystemProperty.JAVA_IO_TMPDIR;\n import static com.google.common.base.StandardSystemProperty.OS_NAME;\n import static com.google.common.truth.Truth.assertThat;\n import static java.lang.Math.min;\n@@ -73,10 +72,6 @@ private void testThreshold(\n \n     // Write data to go over the threshold\n     if (chunk2 > 0) {\n-      if (JAVA_IO_TMPDIR.value().equals(\"/sdcard\")) {\n-        assertThrows(IOException.class, () -> write(out, data, chunk1, chunk2, singleByte));\n-        return;\n-      }\n       write(out, data, chunk1, chunk2, singleByte);\n       file = out.getFile();\n       assertEquals(dataSize, file.length());\n@@ -132,10 +127,6 @@ public void testWriteErrorAfterClose() throws Exception {\n     FileBackedOutputStream out = new FileBackedOutputStream(50);\n     ByteSource source = out.asByteSource();\n \n-    if (JAVA_IO_TMPDIR.value().equals(\"/sdcard\")) {\n-      assertThrows(IOException.class, () -> out.write(data));\n-      return;\n-    }\n     out.write(data);\n     assertTrue(Arrays.equals(data, source.read()));\n "
    },
    {
      "filename": "guava-tests/test/com/google/common/io/FilesCreateTempDirTest.java",
      "status": "modified",
      "additions": 0,
      "deletions": 6,
      "changes": 6,
      "patch": "@@ -16,14 +16,12 @@\n \n package com.google.common.io;\n \n-import static com.google.common.base.StandardSystemProperty.JAVA_IO_TMPDIR;\n import static com.google.common.base.StandardSystemProperty.JAVA_SPECIFICATION_VERSION;\n import static com.google.common.base.StandardSystemProperty.OS_NAME;\n import static com.google.common.truth.Truth.assertThat;\n import static java.nio.file.attribute.PosixFilePermission.OWNER_EXECUTE;\n import static java.nio.file.attribute.PosixFilePermission.OWNER_READ;\n import static java.nio.file.attribute.PosixFilePermission.OWNER_WRITE;\n-import static org.junit.Assert.assertThrows;\n \n import java.io.File;\n import java.io.IOException;\n@@ -42,10 +40,6 @@\n @NullUnmarked\n public class FilesCreateTempDirTest extends TestCase {\n   public void testCreateTempDir() throws IOException {\n-    if (JAVA_IO_TMPDIR.value().equals(\"/sdcard\")) {\n-      assertThrows(IllegalStateException.class, Files::createTempDir);\n-      return;\n-    }\n     File temp = Files.createTempDir();\n     try {\n       assertThat(temp.exists()).isTrue();"
    }
  ],
  "diff": "diff --git a/android/guava-tests/test/com/google/common/io/FileBackedOutputStreamTest.java b/android/guava-tests/test/com/google/common/io/FileBackedOutputStreamTest.java\nindex 3cbf5a1028a7..7699ea2f4796 100644\n--- a/android/guava-tests/test/com/google/common/io/FileBackedOutputStreamTest.java\n+++ b/android/guava-tests/test/com/google/common/io/FileBackedOutputStreamTest.java\n@@ -16,7 +16,6 @@\n \n package com.google.common.io;\n \n-import static com.google.common.base.StandardSystemProperty.JAVA_IO_TMPDIR;\n import static com.google.common.base.StandardSystemProperty.OS_NAME;\n import static com.google.common.truth.Truth.assertThat;\n import static java.lang.Math.min;\n@@ -73,10 +72,6 @@ private void testThreshold(\n \n     // Write data to go over the threshold\n     if (chunk2 > 0) {\n-      if (JAVA_IO_TMPDIR.value().equals(\"/sdcard\")) {\n-        assertThrows(IOException.class, () -> write(out, data, chunk1, chunk2, singleByte));\n-        return;\n-      }\n       write(out, data, chunk1, chunk2, singleByte);\n       file = out.getFile();\n       assertEquals(dataSize, file.length());\n@@ -132,10 +127,6 @@ public void testWriteErrorAfterClose() throws Exception {\n     FileBackedOutputStream out = new FileBackedOutputStream(50);\n     ByteSource source = out.asByteSource();\n \n-    if (JAVA_IO_TMPDIR.value().equals(\"/sdcard\")) {\n-      assertThrows(IOException.class, () -> out.write(data));\n-      return;\n-    }\n     out.write(data);\n     assertTrue(Arrays.equals(data, source.read()));\n \ndiff --git a/android/guava-tests/test/com/google/common/io/FilesCreateTempDirTest.java b/android/guava-tests/test/com/google/common/io/FilesCreateTempDirTest.java\nindex 1b15f3c8569b..90c91aa280d6 100644\n--- a/android/guava-tests/test/com/google/common/io/FilesCreateTempDirTest.java\n+++ b/android/guava-tests/test/com/google/common/io/FilesCreateTempDirTest.java\n@@ -16,14 +16,12 @@\n \n package com.google.common.io;\n \n-import static com.google.common.base.StandardSystemProperty.JAVA_IO_TMPDIR;\n import static com.google.common.base.StandardSystemProperty.JAVA_SPECIFICATION_VERSION;\n import static com.google.common.base.StandardSystemProperty.OS_NAME;\n import static com.google.common.truth.Truth.assertThat;\n import static java.nio.file.attribute.PosixFilePermission.OWNER_EXECUTE;\n import static java.nio.file.attribute.PosixFilePermission.OWNER_READ;\n import static java.nio.file.attribute.PosixFilePermission.OWNER_WRITE;\n-import static org.junit.Assert.assertThrows;\n \n import java.io.File;\n import java.io.IOException;\n@@ -42,10 +40,6 @@\n @NullUnmarked\n public class FilesCreateTempDirTest extends TestCase {\n   public void testCreateTempDir() throws IOException {\n-    if (JAVA_IO_TMPDIR.value().equals(\"/sdcard\")) {\n-      assertThrows(IllegalStateException.class, Files::createTempDir);\n-      return;\n-    }\n     File temp = Files.createTempDir();\n     try {\n       assertThat(temp.exists()).isTrue();\ndiff --git a/guava-tests/test/com/google/common/io/FileBackedOutputStreamTest.java b/guava-tests/test/com/google/common/io/FileBackedOutputStreamTest.java\nindex 3cbf5a1028a7..7699ea2f4796 100644\n--- a/guava-tests/test/com/google/common/io/FileBackedOutputStreamTest.java\n+++ b/guava-tests/test/com/google/common/io/FileBackedOutputStreamTest.java\n@@ -16,7 +16,6 @@\n \n package com.google.common.io;\n \n-import static com.google.common.base.StandardSystemProperty.JAVA_IO_TMPDIR;\n import static com.google.common.base.StandardSystemProperty.OS_NAME;\n import static com.google.common.truth.Truth.assertThat;\n import static java.lang.Math.min;\n@@ -73,10 +72,6 @@ private void testThreshold(\n \n     // Write data to go over the threshold\n     if (chunk2 > 0) {\n-      if (JAVA_IO_TMPDIR.value().equals(\"/sdcard\")) {\n-        assertThrows(IOException.class, () -> write(out, data, chunk1, chunk2, singleByte));\n-        return;\n-      }\n       write(out, data, chunk1, chunk2, singleByte);\n       file = out.getFile();\n       assertEquals(dataSize, file.length());\n@@ -132,10 +127,6 @@ public void testWriteErrorAfterClose() throws Exception {\n     FileBackedOutputStream out = new FileBackedOutputStream(50);\n     ByteSource source = out.asByteSource();\n \n-    if (JAVA_IO_TMPDIR.value().equals(\"/sdcard\")) {\n-      assertThrows(IOException.class, () -> out.write(data));\n-      return;\n-    }\n     out.write(data);\n     assertTrue(Arrays.equals(data, source.read()));\n \ndiff --git a/guava-tests/test/com/google/common/io/FilesCreateTempDirTest.java b/guava-tests/test/com/google/common/io/FilesCreateTempDirTest.java\nindex 1b15f3c8569b..90c91aa280d6 100644\n--- a/guava-tests/test/com/google/common/io/FilesCreateTempDirTest.java\n+++ b/guava-tests/test/com/google/common/io/FilesCreateTempDirTest.java\n@@ -16,14 +16,12 @@\n \n package com.google.common.io;\n \n-import static com.google.common.base.StandardSystemProperty.JAVA_IO_TMPDIR;\n import static com.google.common.base.StandardSystemProperty.JAVA_SPECIFICATION_VERSION;\n import static com.google.common.base.StandardSystemProperty.OS_NAME;\n import static com.google.common.truth.Truth.assertThat;\n import static java.nio.file.attribute.PosixFilePermission.OWNER_EXECUTE;\n import static java.nio.file.attribute.PosixFilePermission.OWNER_READ;\n import static java.nio.file.attribute.PosixFilePermission.OWNER_WRITE;\n-import static org.junit.Assert.assertThrows;\n \n import java.io.File;\n import java.io.IOException;\n@@ -42,10 +40,6 @@\n @NullUnmarked\n public class FilesCreateTempDirTest extends TestCase {\n   public void testCreateTempDir() throws IOException {\n-    if (JAVA_IO_TMPDIR.value().equals(\"/sdcard\")) {\n-      assertThrows(IllegalStateException.class, Files::createTempDir);\n-      return;\n-    }\n     File temp = Files.createTempDir();\n     try {\n       assertThat(temp.exists()).isTrue();\n",
  "additions": 0,
  "deletions": 30,
  "changed_files": 4,
  "url": "https://github.com/google/guava/pull/8025",
  "mined_at": "2025-10-25T12:55:06.978887"
}
{
  "id": 137092,
  "repository": "elastic/elasticsearch",
  "title": "ESQL: Fixes ValuesTests OOM",
  "body": "Closes https://github.com/elastic/elasticsearch/issues/128649\r\nCloses https://github.com/elastic/elasticsearch/issues/128709\r\n\r\n\r\nThis was done for 9.0 onwards here: https://github.com/elastic/elasticsearch/pull/124685",
  "state": "closed",
  "merged": true,
  "merged_at": "2025-10-24T12:25:00+00:00",
  "created_at": "2025-10-24T10:08:39+00:00",
  "updated_at": "2025-10-24T12:25:00+00:00",
  "author": "ncordon",
  "reviewers": [
    "idegtiarenko",
    "craigtaverner"
  ],
  "base_sha": "89eceba7626e066e7172423310d1e0d53d722bd0",
  "head_sha": "eeb65fc17ee19d36c217de244e5763fce9792a71",
  "review_comments": [
    {
      "user": "craigtaverner",
      "state": "CHANGES_REQUESTED",
      "body": "This is not a bug-fix, but a change to tests. So the labels should be `>test` and not `>bug`, and there should be no changelog yaml file.",
      "submitted_at": "2025-10-24T10:39:34+00:00"
    },
    {
      "user": "craigtaverner",
      "state": "APPROVED",
      "body": "LGTM",
      "submitted_at": "2025-10-24T11:01:05+00:00"
    },
    {
      "user": "idegtiarenko",
      "state": "APPROVED",
      "body": "",
      "submitted_at": "2025-10-24T11:43:57+00:00"
    }
  ],
  "pr_comments": [
    {
      "user": "elasticsearchmachine",
      "body": "Pinging @elastic/es-analytical-engine (Team:Analytics)",
      "created_at": "2025-10-24T10:09:23+00:00"
    },
    {
      "user": "elasticsearchmachine",
      "body": "Hi @ncordon, I've created a changelog YAML for you.",
      "created_at": "2025-10-24T10:09:24+00:00"
    }
  ],
  "files_changed": [
    {
      "filename": "x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/aggregate/ValuesTests.java",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "patch": "@@ -56,8 +56,8 @@ public static Iterable<Object[]> parameters() {\n             // For spatial types, we can have many rows for points, but reduce rows for shapes to avoid circuit breaker\n             MultiRowTestCaseSupplier.geoPointCases(1, 1000, MultiRowTestCaseSupplier.IncludingAltitude.NO),\n             MultiRowTestCaseSupplier.cartesianPointCases(1, 1000, MultiRowTestCaseSupplier.IncludingAltitude.NO),\n-            MultiRowTestCaseSupplier.geoShapeCasesWithoutCircle(1, 100, MultiRowTestCaseSupplier.IncludingAltitude.NO),\n-            MultiRowTestCaseSupplier.cartesianShapeCasesWithoutCircle(1, 100, MultiRowTestCaseSupplier.IncludingAltitude.NO)\n+            MultiRowTestCaseSupplier.geoShapeCasesWithoutCircle(1, 20, MultiRowTestCaseSupplier.IncludingAltitude.NO),\n+            MultiRowTestCaseSupplier.cartesianShapeCasesWithoutCircle(1, 20, MultiRowTestCaseSupplier.IncludingAltitude.NO)\n         ).flatMap(List::stream).map(ValuesTests::makeSupplier).collect(Collectors.toCollection(() -> suppliers));\n \n         return parameterSuppliersFromTypedDataWithDefaultChecksNoErrors(suppliers, false);"
    }
  ],
  "diff": "diff --git a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/aggregate/ValuesTests.java b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/aggregate/ValuesTests.java\nindex f5f926854f754..11c7476eb4b03 100644\n--- a/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/aggregate/ValuesTests.java\n+++ b/x-pack/plugin/esql/src/test/java/org/elasticsearch/xpack/esql/expression/function/aggregate/ValuesTests.java\n@@ -56,8 +56,8 @@ public static Iterable<Object[]> parameters() {\n             // For spatial types, we can have many rows for points, but reduce rows for shapes to avoid circuit breaker\n             MultiRowTestCaseSupplier.geoPointCases(1, 1000, MultiRowTestCaseSupplier.IncludingAltitude.NO),\n             MultiRowTestCaseSupplier.cartesianPointCases(1, 1000, MultiRowTestCaseSupplier.IncludingAltitude.NO),\n-            MultiRowTestCaseSupplier.geoShapeCasesWithoutCircle(1, 100, MultiRowTestCaseSupplier.IncludingAltitude.NO),\n-            MultiRowTestCaseSupplier.cartesianShapeCasesWithoutCircle(1, 100, MultiRowTestCaseSupplier.IncludingAltitude.NO)\n+            MultiRowTestCaseSupplier.geoShapeCasesWithoutCircle(1, 20, MultiRowTestCaseSupplier.IncludingAltitude.NO),\n+            MultiRowTestCaseSupplier.cartesianShapeCasesWithoutCircle(1, 20, MultiRowTestCaseSupplier.IncludingAltitude.NO)\n         ).flatMap(List::stream).map(ValuesTests::makeSupplier).collect(Collectors.toCollection(() -> suppliers));\n \n         return parameterSuppliersFromTypedDataWithDefaultChecksNoErrors(suppliers, false);\n",
  "additions": 2,
  "deletions": 2,
  "changed_files": 1,
  "url": "https://github.com/elastic/elasticsearch/pull/137092",
  "mined_at": "2025-10-25T13:24:37.788713"
}
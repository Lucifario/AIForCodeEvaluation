{
  "id": 137133,
  "repository": "elastic/elasticsearch",
  "title": "Test utility for `POST _features/_reset`",
  "body": "We call `POST _features/_reset` in various places in the tests, only\r\nsometimes asserting that the response is `200 OK`. This commit extracts\r\na utility that makes it harder to miss this assertion. It also adds the\r\n`?error_trace` parameter so that on failure the details are visible in\r\nthe response, and `?master_timeout=-1` to avoid spurious timeouts if CI\r\nis running a little slow.",
  "state": "closed",
  "merged": true,
  "merged_at": "2025-10-25T09:46:43+00:00",
  "created_at": "2025-10-24T20:49:56+00:00",
  "updated_at": "2025-10-25T14:07:04+00:00",
  "author": "DaveCTurner",
  "reviewers": [
    "rjernst"
  ],
  "base_sha": "045893799b7adc0484935745873d5a787af1b678",
  "head_sha": "069b80a15699952e50b0be5c29d23e1381870dd2",
  "review_comments": [
    {
      "user": "rjernst",
      "state": "APPROVED",
      "body": "LGTM",
      "submitted_at": "2025-10-24T20:57:55+00:00"
    }
  ],
  "pr_comments": [
    {
      "user": "elasticsearchmachine",
      "body": "Pinging @elastic/es-core-infra (Team:Core/Infra)",
      "created_at": "2025-10-24T20:50:21+00:00"
    },
    {
      "user": "DaveCTurner",
      "body": "I've had to revert this because we only added the `?master_timeout` parameter in https://github.com/elastic/elasticsearch/pull/109828 (8.15.0) but there are apparently some tests that use this utility with older versions: https://github.com/elastic/elasticsearch/issues/137144",
      "created_at": "2025-10-25T14:06:58+00:00"
    }
  ],
  "files_changed": [
    {
      "filename": "qa/system-indices/src/javaRestTest/java/org/elasticsearch/system/indices/FeatureUpgradeApiIT.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "patch": "@@ -29,7 +29,7 @@ public class FeatureUpgradeApiIT extends AbstractSystemIndicesIT {\n \n     @After\n     public void resetFeatures() throws Exception {\n-        client().performRequest(new Request(\"POST\", \"/_features/_reset\"));\n+        performPostFeaturesReset(client());\n     }\n \n     public void testCreatingSystemIndex() throws Exception {"
    },
    {
      "filename": "qa/system-indices/src/javaRestTest/java/org/elasticsearch/system/indices/NetNewSystemIndicesIT.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "patch": "@@ -94,6 +94,6 @@ public void testSearch() throws Exception {\n \n     @After\n     public void resetFeatures() throws Exception {\n-        client().performRequest(new Request(\"POST\", \"/_features/_reset\"));\n+        performPostFeaturesReset(client());\n     }\n }"
    },
    {
      "filename": "qa/system-indices/src/javaRestTest/java/org/elasticsearch/system/indices/SystemAliasIT.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "patch": "@@ -26,7 +26,7 @@ public class SystemAliasIT extends AbstractSystemIndicesIT {\n \n     @After\n     public void resetFeatures() throws Exception {\n-        client().performRequest(new Request(\"POST\", \"/_features/_reset\"));\n+        performPostFeaturesReset(client());\n     }\n \n     public void testCreatingSystemIndexWithAlias() throws Exception {"
    },
    {
      "filename": "test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java",
      "status": "modified",
      "additions": 11,
      "deletions": 2,
      "changes": 13,
      "patch": "@@ -925,6 +925,16 @@ protected boolean preserveSearchableSnapshotsIndicesUponCompletion() {\n         return false;\n     }\n \n+    /**\n+     * Invoke {@code POST /_features/_reset?error_trace&master_timeout=-1} with the given {@link RestClient}.\n+     */\n+    public static void performPostFeaturesReset(RestClient restClient) throws IOException {\n+        final var request = new Request(HttpPost.METHOD_NAME, \"/_features/_reset\");\n+        request.addParameter(\"error_trace\", \"true\");\n+        request.addParameter(\"master_timeout\", \"-1\");\n+        assertOK(restClient.performRequest(request));\n+    }\n+\n     private void wipeCluster() throws Exception {\n         waitForClusterUpdates();\n \n@@ -951,8 +961,7 @@ private void wipeCluster() throws Exception {\n         wipeSnapshots();\n \n         if (resetFeatureStates()) {\n-            final Request postRequest = new Request(\"POST\", \"/_features/_reset\");\n-            cleanupClient().performRequest(postRequest);\n+            performPostFeaturesReset(cleanupClient());\n         }\n \n         // wipe data streams before indices so that the backing indices for data streams are handled properly"
    },
    {
      "filename": "x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/ml/integration/MlRestTestStateCleaner.java",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "patch": "@@ -17,6 +17,7 @@\n import java.util.List;\n import java.util.Map;\n \n+import static org.elasticsearch.test.rest.ESRestTestCase.performPostFeaturesReset;\n import static org.hamcrest.MatcherAssert.assertThat;\n import static org.hamcrest.Matchers.hasSize;\n \n@@ -33,7 +34,7 @@ public MlRestTestStateCleaner(Logger logger, RestClient adminClient) {\n     public void resetFeatures() throws IOException {\n         deletePipelinesWithInferenceProcessors();\n         // This resets all features, not just ML, but they should have been getting reset between tests anyway so it shouldn't matter\n-        adminClient.performRequest(new Request(\"POST\", \"/_features/_reset\"));\n+        performPostFeaturesReset(adminClient);\n     }\n \n     @SuppressWarnings(\"unchecked\")"
    },
    {
      "filename": "x-pack/plugin/deprecation/qa/src/javaRestTest/java/org/elasticsearch/xpack/deprecation/MlDeprecationIT.java",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "patch": "@@ -59,8 +59,7 @@ protected String getTestRestCluster() {\n \n     @After\n     public void resetFeatures() throws IOException {\n-        Response response = adminClient().performRequest(new Request(\"POST\", \"/_features/_reset\"));\n-        assertOK(response);\n+        performPostFeaturesReset(adminClient());\n     }\n \n     @Override"
    },
    {
      "filename": "x-pack/plugin/ml/qa/disabled/src/javaRestTest/java/org/elasticsearch/xpack/ml/integration/MlPluginDisabledIT.java",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "patch": "@@ -75,8 +75,7 @@ public void testActionsFail() throws Exception {\n     }\n \n     public void testMlFeatureReset() throws IOException {\n-        Request request = new Request(\"POST\", \"/_features/_reset\");\n-        assertOK(client().performRequest(request));\n+        performPostFeaturesReset(client());\n     }\n \n     @SuppressWarnings(\"unchecked\")"
    },
    {
      "filename": "x-pack/plugin/ml/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/ml/integration/InferenceTestCase.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "patch": "@@ -33,7 +33,7 @@ public void cleanup() throws Exception {\n         }\n         createdPipelines.clear();\n         waitForStats();\n-        adminClient().performRequest(new Request(\"POST\", \"/_features/_reset\"));\n+        performPostFeaturesReset(adminClient());\n     }\n \n     void deletePipeline(String pipelineId) throws IOException {"
    },
    {
      "filename": "x-pack/plugin/transform/qa/multi-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TestFeatureResetIT.java",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "patch": "@@ -6,7 +6,6 @@\n  */\n package org.elasticsearch.xpack.transform.integration;\n \n-import org.apache.http.client.methods.HttpPost;\n import org.elasticsearch.client.Request;\n import org.elasticsearch.client.RequestOptions;\n import org.elasticsearch.client.Response;\n@@ -95,7 +94,7 @@ public void testTransformFeatureReset() throws Exception {\n \n         startTransform(continuousTransformId, RequestOptions.DEFAULT);\n \n-        assertOK(client().performRequest(new Request(HttpPost.METHOD_NAME, \"/_features/_reset\")));\n+        performPostFeaturesReset(client());\n \n         Response response = adminClient().performRequest(new Request(\"GET\", \"/_cluster/state?metric=metadata\"));\n         Map<String, Object> metadata = (Map<String, Object>) ESRestTestCase.entityAsMap(response).get(\"metadata\");"
    },
    {
      "filename": "x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformGetAndGetStatsIT.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "patch": "@@ -66,7 +66,7 @@ public void createIndexes() throws IOException {\n \n     @After\n     public void clearOutTransforms() throws Exception {\n-        adminClient().performRequest(new Request(\"POST\", \"/_features/_reset\"));\n+        performPostFeaturesReset(adminClient());\n     }\n \n     @SuppressWarnings(\"unchecked\")"
    },
    {
      "filename": "x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformRestTestCase.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "patch": "@@ -648,7 +648,7 @@ public void waitForTransform() throws Exception {\n         ensureNoInitializingShards();\n         logAudits();\n         if (preserveClusterUponCompletion() == false) {\n-            adminClient().performRequest(new Request(\"POST\", \"/_features/_reset\"));\n+            performPostFeaturesReset(adminClient());\n         }\n     }\n "
    },
    {
      "filename": "x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformTaskFailedStateIT.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "patch": "@@ -54,7 +54,7 @@ public void setClusterSettings() throws IOException {\n \n     @After\n     public void cleanUpPotentiallyFailedTransform() throws Exception {\n-        adminClient().performRequest(new Request(\"POST\", \"/_features/_reset\"));\n+        performPostFeaturesReset(adminClient());\n     }\n \n     public void testForceStopFailedTransform() throws Exception {"
    },
    {
      "filename": "x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformUpgradeModeIT.java",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "patch": "@@ -7,7 +7,6 @@\n \n package org.elasticsearch.xpack.transform.integration;\n \n-import org.elasticsearch.client.Request;\n import org.elasticsearch.client.Response;\n import org.elasticsearch.client.ResponseException;\n import org.elasticsearch.common.xcontent.support.XContentMapValues;\n@@ -53,7 +52,7 @@ public void createIndexes() throws IOException {\n \n     @After\n     public void clearOutTransforms() throws Exception {\n-        adminClient().performRequest(new Request(\"POST\", \"/_features/_reset\"));\n+        performPostFeaturesReset(adminClient());\n     }\n \n     public void testUpgradeMode() throws Exception {"
    }
  ],
  "diff": "diff --git a/qa/system-indices/src/javaRestTest/java/org/elasticsearch/system/indices/FeatureUpgradeApiIT.java b/qa/system-indices/src/javaRestTest/java/org/elasticsearch/system/indices/FeatureUpgradeApiIT.java\nindex 62bc23ee4ad87..548e61199b7d7 100644\n--- a/qa/system-indices/src/javaRestTest/java/org/elasticsearch/system/indices/FeatureUpgradeApiIT.java\n+++ b/qa/system-indices/src/javaRestTest/java/org/elasticsearch/system/indices/FeatureUpgradeApiIT.java\n@@ -29,7 +29,7 @@ public class FeatureUpgradeApiIT extends AbstractSystemIndicesIT {\n \n     @After\n     public void resetFeatures() throws Exception {\n-        client().performRequest(new Request(\"POST\", \"/_features/_reset\"));\n+        performPostFeaturesReset(client());\n     }\n \n     public void testCreatingSystemIndex() throws Exception {\ndiff --git a/qa/system-indices/src/javaRestTest/java/org/elasticsearch/system/indices/NetNewSystemIndicesIT.java b/qa/system-indices/src/javaRestTest/java/org/elasticsearch/system/indices/NetNewSystemIndicesIT.java\nindex 1f497322647d4..d2ce68101be49 100644\n--- a/qa/system-indices/src/javaRestTest/java/org/elasticsearch/system/indices/NetNewSystemIndicesIT.java\n+++ b/qa/system-indices/src/javaRestTest/java/org/elasticsearch/system/indices/NetNewSystemIndicesIT.java\n@@ -94,6 +94,6 @@ public void testSearch() throws Exception {\n \n     @After\n     public void resetFeatures() throws Exception {\n-        client().performRequest(new Request(\"POST\", \"/_features/_reset\"));\n+        performPostFeaturesReset(client());\n     }\n }\ndiff --git a/qa/system-indices/src/javaRestTest/java/org/elasticsearch/system/indices/SystemAliasIT.java b/qa/system-indices/src/javaRestTest/java/org/elasticsearch/system/indices/SystemAliasIT.java\nindex 1a724fcab2b07..bec0d1dbae4ac 100644\n--- a/qa/system-indices/src/javaRestTest/java/org/elasticsearch/system/indices/SystemAliasIT.java\n+++ b/qa/system-indices/src/javaRestTest/java/org/elasticsearch/system/indices/SystemAliasIT.java\n@@ -26,7 +26,7 @@ public class SystemAliasIT extends AbstractSystemIndicesIT {\n \n     @After\n     public void resetFeatures() throws Exception {\n-        client().performRequest(new Request(\"POST\", \"/_features/_reset\"));\n+        performPostFeaturesReset(client());\n     }\n \n     public void testCreatingSystemIndexWithAlias() throws Exception {\ndiff --git a/test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java b/test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java\nindex 5ddd925e4e803..aa6ad7fd31f4b 100644\n--- a/test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java\n+++ b/test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java\n@@ -925,6 +925,16 @@ protected boolean preserveSearchableSnapshotsIndicesUponCompletion() {\n         return false;\n     }\n \n+    /**\n+     * Invoke {@code POST /_features/_reset?error_trace&master_timeout=-1} with the given {@link RestClient}.\n+     */\n+    public static void performPostFeaturesReset(RestClient restClient) throws IOException {\n+        final var request = new Request(HttpPost.METHOD_NAME, \"/_features/_reset\");\n+        request.addParameter(\"error_trace\", \"true\");\n+        request.addParameter(\"master_timeout\", \"-1\");\n+        assertOK(restClient.performRequest(request));\n+    }\n+\n     private void wipeCluster() throws Exception {\n         waitForClusterUpdates();\n \n@@ -951,8 +961,7 @@ private void wipeCluster() throws Exception {\n         wipeSnapshots();\n \n         if (resetFeatureStates()) {\n-            final Request postRequest = new Request(\"POST\", \"/_features/_reset\");\n-            cleanupClient().performRequest(postRequest);\n+            performPostFeaturesReset(cleanupClient());\n         }\n \n         // wipe data streams before indices so that the backing indices for data streams are handled properly\ndiff --git a/x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/ml/integration/MlRestTestStateCleaner.java b/x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/ml/integration/MlRestTestStateCleaner.java\nindex 25d9509ecdc7a..a8916a7455448 100644\n--- a/x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/ml/integration/MlRestTestStateCleaner.java\n+++ b/x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/ml/integration/MlRestTestStateCleaner.java\n@@ -17,6 +17,7 @@\n import java.util.List;\n import java.util.Map;\n \n+import static org.elasticsearch.test.rest.ESRestTestCase.performPostFeaturesReset;\n import static org.hamcrest.MatcherAssert.assertThat;\n import static org.hamcrest.Matchers.hasSize;\n \n@@ -33,7 +34,7 @@ public MlRestTestStateCleaner(Logger logger, RestClient adminClient) {\n     public void resetFeatures() throws IOException {\n         deletePipelinesWithInferenceProcessors();\n         // This resets all features, not just ML, but they should have been getting reset between tests anyway so it shouldn't matter\n-        adminClient.performRequest(new Request(\"POST\", \"/_features/_reset\"));\n+        performPostFeaturesReset(adminClient);\n     }\n \n     @SuppressWarnings(\"unchecked\")\ndiff --git a/x-pack/plugin/deprecation/qa/src/javaRestTest/java/org/elasticsearch/xpack/deprecation/MlDeprecationIT.java b/x-pack/plugin/deprecation/qa/src/javaRestTest/java/org/elasticsearch/xpack/deprecation/MlDeprecationIT.java\nindex 4ee5f39e8df55..11f8140485187 100644\n--- a/x-pack/plugin/deprecation/qa/src/javaRestTest/java/org/elasticsearch/xpack/deprecation/MlDeprecationIT.java\n+++ b/x-pack/plugin/deprecation/qa/src/javaRestTest/java/org/elasticsearch/xpack/deprecation/MlDeprecationIT.java\n@@ -59,8 +59,7 @@ protected String getTestRestCluster() {\n \n     @After\n     public void resetFeatures() throws IOException {\n-        Response response = adminClient().performRequest(new Request(\"POST\", \"/_features/_reset\"));\n-        assertOK(response);\n+        performPostFeaturesReset(adminClient());\n     }\n \n     @Override\ndiff --git a/x-pack/plugin/ml/qa/disabled/src/javaRestTest/java/org/elasticsearch/xpack/ml/integration/MlPluginDisabledIT.java b/x-pack/plugin/ml/qa/disabled/src/javaRestTest/java/org/elasticsearch/xpack/ml/integration/MlPluginDisabledIT.java\nindex a518e0d496868..e9405074b5645 100644\n--- a/x-pack/plugin/ml/qa/disabled/src/javaRestTest/java/org/elasticsearch/xpack/ml/integration/MlPluginDisabledIT.java\n+++ b/x-pack/plugin/ml/qa/disabled/src/javaRestTest/java/org/elasticsearch/xpack/ml/integration/MlPluginDisabledIT.java\n@@ -75,8 +75,7 @@ public void testActionsFail() throws Exception {\n     }\n \n     public void testMlFeatureReset() throws IOException {\n-        Request request = new Request(\"POST\", \"/_features/_reset\");\n-        assertOK(client().performRequest(request));\n+        performPostFeaturesReset(client());\n     }\n \n     @SuppressWarnings(\"unchecked\")\ndiff --git a/x-pack/plugin/ml/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/ml/integration/InferenceTestCase.java b/x-pack/plugin/ml/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/ml/integration/InferenceTestCase.java\nindex 5adcf649f6e02..0551884261d82 100644\n--- a/x-pack/plugin/ml/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/ml/integration/InferenceTestCase.java\n+++ b/x-pack/plugin/ml/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/ml/integration/InferenceTestCase.java\n@@ -33,7 +33,7 @@ public void cleanup() throws Exception {\n         }\n         createdPipelines.clear();\n         waitForStats();\n-        adminClient().performRequest(new Request(\"POST\", \"/_features/_reset\"));\n+        performPostFeaturesReset(adminClient());\n     }\n \n     void deletePipeline(String pipelineId) throws IOException {\ndiff --git a/x-pack/plugin/transform/qa/multi-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TestFeatureResetIT.java b/x-pack/plugin/transform/qa/multi-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TestFeatureResetIT.java\nindex 60bb04fe6cb8a..7fd4ee88c7714 100644\n--- a/x-pack/plugin/transform/qa/multi-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TestFeatureResetIT.java\n+++ b/x-pack/plugin/transform/qa/multi-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TestFeatureResetIT.java\n@@ -6,7 +6,6 @@\n  */\n package org.elasticsearch.xpack.transform.integration;\n \n-import org.apache.http.client.methods.HttpPost;\n import org.elasticsearch.client.Request;\n import org.elasticsearch.client.RequestOptions;\n import org.elasticsearch.client.Response;\n@@ -95,7 +94,7 @@ public void testTransformFeatureReset() throws Exception {\n \n         startTransform(continuousTransformId, RequestOptions.DEFAULT);\n \n-        assertOK(client().performRequest(new Request(HttpPost.METHOD_NAME, \"/_features/_reset\")));\n+        performPostFeaturesReset(client());\n \n         Response response = adminClient().performRequest(new Request(\"GET\", \"/_cluster/state?metric=metadata\"));\n         Map<String, Object> metadata = (Map<String, Object>) ESRestTestCase.entityAsMap(response).get(\"metadata\");\ndiff --git a/x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformGetAndGetStatsIT.java b/x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformGetAndGetStatsIT.java\nindex 4c7ab877cbc65..aa3488b575ad6 100644\n--- a/x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformGetAndGetStatsIT.java\n+++ b/x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformGetAndGetStatsIT.java\n@@ -66,7 +66,7 @@ public void createIndexes() throws IOException {\n \n     @After\n     public void clearOutTransforms() throws Exception {\n-        adminClient().performRequest(new Request(\"POST\", \"/_features/_reset\"));\n+        performPostFeaturesReset(adminClient());\n     }\n \n     @SuppressWarnings(\"unchecked\")\ndiff --git a/x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformRestTestCase.java b/x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformRestTestCase.java\nindex 96478f5576107..0eb48ea896afc 100644\n--- a/x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformRestTestCase.java\n+++ b/x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformRestTestCase.java\n@@ -648,7 +648,7 @@ public void waitForTransform() throws Exception {\n         ensureNoInitializingShards();\n         logAudits();\n         if (preserveClusterUponCompletion() == false) {\n-            adminClient().performRequest(new Request(\"POST\", \"/_features/_reset\"));\n+            performPostFeaturesReset(adminClient());\n         }\n     }\n \ndiff --git a/x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformTaskFailedStateIT.java b/x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformTaskFailedStateIT.java\nindex 5ab65ca023506..cff760565087b 100644\n--- a/x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformTaskFailedStateIT.java\n+++ b/x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformTaskFailedStateIT.java\n@@ -54,7 +54,7 @@ public void setClusterSettings() throws IOException {\n \n     @After\n     public void cleanUpPotentiallyFailedTransform() throws Exception {\n-        adminClient().performRequest(new Request(\"POST\", \"/_features/_reset\"));\n+        performPostFeaturesReset(adminClient());\n     }\n \n     public void testForceStopFailedTransform() throws Exception {\ndiff --git a/x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformUpgradeModeIT.java b/x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformUpgradeModeIT.java\nindex 437d7aa5e26d9..e1b0b0473c554 100644\n--- a/x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformUpgradeModeIT.java\n+++ b/x-pack/plugin/transform/qa/single-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/TransformUpgradeModeIT.java\n@@ -7,7 +7,6 @@\n \n package org.elasticsearch.xpack.transform.integration;\n \n-import org.elasticsearch.client.Request;\n import org.elasticsearch.client.Response;\n import org.elasticsearch.client.ResponseException;\n import org.elasticsearch.common.xcontent.support.XContentMapValues;\n@@ -53,7 +52,7 @@ public void createIndexes() throws IOException {\n \n     @After\n     public void clearOutTransforms() throws Exception {\n-        adminClient().performRequest(new Request(\"POST\", \"/_features/_reset\"));\n+        performPostFeaturesReset(adminClient());\n     }\n \n     public void testUpgradeMode() throws Exception {\n",
  "additions": 24,
  "deletions": 18,
  "changed_files": 13,
  "url": "https://github.com/elastic/elasticsearch/pull/137133",
  "mined_at": "2025-10-25T13:10:39.463804"
}
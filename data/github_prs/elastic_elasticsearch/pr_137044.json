{
  "id": 137044,
  "repository": "elastic/elasticsearch",
  "title": "[9.2] ESQL: Rename SupportedVersion methods (#137013)",
  "body": "Backports the following commits to 9.2:\n - ESQL: Rename SupportedVersion methods (#137013)",
  "state": "closed",
  "merged": true,
  "merged_at": "2025-10-23T16:31:35+00:00",
  "created_at": "2025-10-23T15:30:52+00:00",
  "updated_at": "2025-10-23T16:31:58+00:00",
  "author": "alex-spies",
  "reviewers": [],
  "base_sha": "458e532fa7e0896929d2afa848a6c04ce5e07f37",
  "head_sha": "7bd192038c7a0d4bbb4dfd6081e21d47207e3b6e",
  "review_comments": [],
  "pr_comments": [],
  "files_changed": [
    {
      "filename": "x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/DataType.java",
      "status": "modified",
      "additions": 14,
      "deletions": 10,
      "changes": 24,
      "patch": "@@ -121,7 +121,7 @@\n  *         Ensure the capabilities for this type are always enabled.</li>\n  *     <li>\n  *         Mark the type with a new transport version via\n- *         {@link Builder#supportedOn(TransportVersion)}. This will enable the type on\n+ *         {@link Builder#supportedSince(TransportVersion)}. This will enable the type on\n  *         non-SNAPSHOT builds as long as all nodes in the cluster (and remote clusters)\n  *         support it.</li>\n  *     <li>\n@@ -296,9 +296,13 @@ public enum DataType implements Writeable {\n     // NOTE: If INDEX_SOURCE somehow gets backported to a version that doesn't actually support these types, we'll be missing validation for\n     // mixed/multi clusters with remotes that don't support these types. This is low-ish risk because these types require specific\n     // geo functions to turn up in the query, and those types aren't available before 9.2.0 either.\n-    GEOHASH(builder().esType(\"geohash\").typeName(\"GEOHASH\").estimatedSize(Long.BYTES).supportedOn(DataTypesTransportVersions.INDEX_SOURCE)),\n-    GEOTILE(builder().esType(\"geotile\").typeName(\"GEOTILE\").estimatedSize(Long.BYTES).supportedOn(DataTypesTransportVersions.INDEX_SOURCE)),\n-    GEOHEX(builder().esType(\"geohex\").typeName(\"GEOHEX\").estimatedSize(Long.BYTES).supportedOn(DataTypesTransportVersions.INDEX_SOURCE)),\n+    GEOHASH(\n+        builder().esType(\"geohash\").typeName(\"GEOHASH\").estimatedSize(Long.BYTES).supportedSince(DataTypesTransportVersions.INDEX_SOURCE)\n+    ),\n+    GEOTILE(\n+        builder().esType(\"geotile\").typeName(\"GEOTILE\").estimatedSize(Long.BYTES).supportedSince(DataTypesTransportVersions.INDEX_SOURCE)\n+    ),\n+    GEOHEX(builder().esType(\"geohex\").typeName(\"GEOHEX\").estimatedSize(Long.BYTES).supportedSince(DataTypesTransportVersions.INDEX_SOURCE)),\n \n     /**\n      * Fields with this type represent a Lucene doc id. This field is a bit magic in that:\n@@ -322,7 +326,7 @@ public enum DataType implements Writeable {\n     // mixed/multi clusters with remotes that don't support these types. This is low-ish risk because _tsid requires specifically being\n     // used in `FROM idx METADATA _tsid` or in the `TS` command, which both weren't available before 9.2.0.\n     TSID_DATA_TYPE(\n-        builder().esType(\"_tsid\").estimatedSize(Long.BYTES * 2).docValues().supportedOn(DataTypesTransportVersions.INDEX_SOURCE)\n+        builder().esType(\"_tsid\").estimatedSize(Long.BYTES * 2).docValues().supportedSince(DataTypesTransportVersions.INDEX_SOURCE)\n     ),\n     /**\n      * Fields with this type are the partial result of running a non-time-series aggregation\n@@ -333,13 +337,13 @@ public enum DataType implements Writeable {\n     AGGREGATE_METRIC_DOUBLE(\n         builder().esType(\"aggregate_metric_double\")\n             .estimatedSize(Double.BYTES * 3 + Integer.BYTES)\n-            .supportedOn(DataTypesTransportVersions.ESQL_AGGREGATE_METRIC_DOUBLE_CREATED_VERSION)\n+            .supportedSince(DataTypesTransportVersions.ESQL_AGGREGATE_METRIC_DOUBLE_CREATED_VERSION)\n     ),\n     /**\n      * Fields with this type are dense vectors, represented as an array of float values.\n      */\n     DENSE_VECTOR(\n-        builder().esType(\"dense_vector\").estimatedSize(4096).supportedOn(DataTypesTransportVersions.ESQL_DENSE_VECTOR_CREATED_VERSION)\n+        builder().esType(\"dense_vector\").estimatedSize(4096).supportedSince(DataTypesTransportVersions.ESQL_DENSE_VECTOR_CREATED_VERSION)\n     );\n \n     public static final Set<DataType> UNDER_CONSTRUCTION = Arrays.stream(DataType.values())\n@@ -744,7 +748,7 @@ public DataType counter() {\n \n     @Override\n     public void writeTo(StreamOutput out) throws IOException {\n-        if (supportedVersion.supports(out.getTransportVersion()) == false) {\n+        if (supportedVersion.supportedOn(out.getTransportVersion()) == false) {\n             /*\n              * TODO when we implement version aware planning flip this to an IllegalStateException\n              * so we throw a 500 error. It'll be our bug then. Right now it's a sign that the user\n@@ -955,8 +959,8 @@ Builder counter(DataType counter) {\n          * <p>\n          * Generally, we should add a dedicated transport version when a type is enabled on release builds.\n          */\n-        Builder supportedOn(TransportVersion supportedVersion) {\n-            this.supportedVersion = SupportedVersion.supportedOn(supportedVersion);\n+        Builder supportedSince(TransportVersion supportedVersion) {\n+            this.supportedVersion = SupportedVersion.supportedSince(supportedVersion);\n             return this;\n         }\n "
    },
    {
      "filename": "x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/SupportedVersion.java",
      "status": "modified",
      "additions": 6,
      "deletions": 6,
      "changes": 12,
      "patch": "@@ -11,15 +11,15 @@\n import org.elasticsearch.TransportVersion;\n \n public interface SupportedVersion {\n-    boolean supports(TransportVersion version);\n+    boolean supportedOn(TransportVersion version);\n \n     default boolean supportedLocally() {\n-        return supports(TransportVersion.current());\n+        return supportedOn(TransportVersion.current());\n     }\n \n     SupportedVersion SUPPORTED_ON_ALL_NODES = new SupportedVersion() {\n         @Override\n-        public boolean supports(TransportVersion version) {\n+        public boolean supportedOn(TransportVersion version) {\n             return true;\n         }\n \n@@ -56,7 +56,7 @@ public String toString() {\n     // Check usage of this constant to be sure.\n     SupportedVersion UNDER_CONSTRUCTION = new SupportedVersion() {\n         @Override\n-        public boolean supports(TransportVersion version) {\n+        public boolean supportedOn(TransportVersion version) {\n             return Build.current().isSnapshot();\n         }\n \n@@ -73,10 +73,10 @@ public String toString() {\n      *     continue to work. Otherwise, we'd have to update bwc tests to skip older versions based\n      *     on a capability check, which can be error-prone and risks turning off an unrelated bwc test.\n      */\n-    static SupportedVersion supportedOn(TransportVersion supportedVersion) {\n+    static SupportedVersion supportedSince(TransportVersion supportedVersion) {\n         return new SupportedVersion() {\n             @Override\n-            public boolean supports(TransportVersion version) {\n+            public boolean supportedOn(TransportVersion version) {\n                 return version.supports(supportedVersion) || Build.current().isSnapshot();\n             }\n "
    }
  ],
  "diff": "diff --git a/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/DataType.java b/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/DataType.java\nindex b7a3204c43692..756c06b72f9d8 100644\n--- a/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/DataType.java\n+++ b/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/DataType.java\n@@ -121,7 +121,7 @@\n  *         Ensure the capabilities for this type are always enabled.</li>\n  *     <li>\n  *         Mark the type with a new transport version via\n- *         {@link Builder#supportedOn(TransportVersion)}. This will enable the type on\n+ *         {@link Builder#supportedSince(TransportVersion)}. This will enable the type on\n  *         non-SNAPSHOT builds as long as all nodes in the cluster (and remote clusters)\n  *         support it.</li>\n  *     <li>\n@@ -296,9 +296,13 @@ public enum DataType implements Writeable {\n     // NOTE: If INDEX_SOURCE somehow gets backported to a version that doesn't actually support these types, we'll be missing validation for\n     // mixed/multi clusters with remotes that don't support these types. This is low-ish risk because these types require specific\n     // geo functions to turn up in the query, and those types aren't available before 9.2.0 either.\n-    GEOHASH(builder().esType(\"geohash\").typeName(\"GEOHASH\").estimatedSize(Long.BYTES).supportedOn(DataTypesTransportVersions.INDEX_SOURCE)),\n-    GEOTILE(builder().esType(\"geotile\").typeName(\"GEOTILE\").estimatedSize(Long.BYTES).supportedOn(DataTypesTransportVersions.INDEX_SOURCE)),\n-    GEOHEX(builder().esType(\"geohex\").typeName(\"GEOHEX\").estimatedSize(Long.BYTES).supportedOn(DataTypesTransportVersions.INDEX_SOURCE)),\n+    GEOHASH(\n+        builder().esType(\"geohash\").typeName(\"GEOHASH\").estimatedSize(Long.BYTES).supportedSince(DataTypesTransportVersions.INDEX_SOURCE)\n+    ),\n+    GEOTILE(\n+        builder().esType(\"geotile\").typeName(\"GEOTILE\").estimatedSize(Long.BYTES).supportedSince(DataTypesTransportVersions.INDEX_SOURCE)\n+    ),\n+    GEOHEX(builder().esType(\"geohex\").typeName(\"GEOHEX\").estimatedSize(Long.BYTES).supportedSince(DataTypesTransportVersions.INDEX_SOURCE)),\n \n     /**\n      * Fields with this type represent a Lucene doc id. This field is a bit magic in that:\n@@ -322,7 +326,7 @@ public enum DataType implements Writeable {\n     // mixed/multi clusters with remotes that don't support these types. This is low-ish risk because _tsid requires specifically being\n     // used in `FROM idx METADATA _tsid` or in the `TS` command, which both weren't available before 9.2.0.\n     TSID_DATA_TYPE(\n-        builder().esType(\"_tsid\").estimatedSize(Long.BYTES * 2).docValues().supportedOn(DataTypesTransportVersions.INDEX_SOURCE)\n+        builder().esType(\"_tsid\").estimatedSize(Long.BYTES * 2).docValues().supportedSince(DataTypesTransportVersions.INDEX_SOURCE)\n     ),\n     /**\n      * Fields with this type are the partial result of running a non-time-series aggregation\n@@ -333,13 +337,13 @@ public enum DataType implements Writeable {\n     AGGREGATE_METRIC_DOUBLE(\n         builder().esType(\"aggregate_metric_double\")\n             .estimatedSize(Double.BYTES * 3 + Integer.BYTES)\n-            .supportedOn(DataTypesTransportVersions.ESQL_AGGREGATE_METRIC_DOUBLE_CREATED_VERSION)\n+            .supportedSince(DataTypesTransportVersions.ESQL_AGGREGATE_METRIC_DOUBLE_CREATED_VERSION)\n     ),\n     /**\n      * Fields with this type are dense vectors, represented as an array of float values.\n      */\n     DENSE_VECTOR(\n-        builder().esType(\"dense_vector\").estimatedSize(4096).supportedOn(DataTypesTransportVersions.ESQL_DENSE_VECTOR_CREATED_VERSION)\n+        builder().esType(\"dense_vector\").estimatedSize(4096).supportedSince(DataTypesTransportVersions.ESQL_DENSE_VECTOR_CREATED_VERSION)\n     );\n \n     public static final Set<DataType> UNDER_CONSTRUCTION = Arrays.stream(DataType.values())\n@@ -744,7 +748,7 @@ public DataType counter() {\n \n     @Override\n     public void writeTo(StreamOutput out) throws IOException {\n-        if (supportedVersion.supports(out.getTransportVersion()) == false) {\n+        if (supportedVersion.supportedOn(out.getTransportVersion()) == false) {\n             /*\n              * TODO when we implement version aware planning flip this to an IllegalStateException\n              * so we throw a 500 error. It'll be our bug then. Right now it's a sign that the user\n@@ -955,8 +959,8 @@ Builder counter(DataType counter) {\n          * <p>\n          * Generally, we should add a dedicated transport version when a type is enabled on release builds.\n          */\n-        Builder supportedOn(TransportVersion supportedVersion) {\n-            this.supportedVersion = SupportedVersion.supportedOn(supportedVersion);\n+        Builder supportedSince(TransportVersion supportedVersion) {\n+            this.supportedVersion = SupportedVersion.supportedSince(supportedVersion);\n             return this;\n         }\n \ndiff --git a/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/SupportedVersion.java b/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/SupportedVersion.java\nindex 694e5b2c2f2d7..6aefd1908d5b2 100644\n--- a/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/SupportedVersion.java\n+++ b/x-pack/plugin/esql-core/src/main/java/org/elasticsearch/xpack/esql/core/type/SupportedVersion.java\n@@ -11,15 +11,15 @@\n import org.elasticsearch.TransportVersion;\n \n public interface SupportedVersion {\n-    boolean supports(TransportVersion version);\n+    boolean supportedOn(TransportVersion version);\n \n     default boolean supportedLocally() {\n-        return supports(TransportVersion.current());\n+        return supportedOn(TransportVersion.current());\n     }\n \n     SupportedVersion SUPPORTED_ON_ALL_NODES = new SupportedVersion() {\n         @Override\n-        public boolean supports(TransportVersion version) {\n+        public boolean supportedOn(TransportVersion version) {\n             return true;\n         }\n \n@@ -56,7 +56,7 @@ public String toString() {\n     // Check usage of this constant to be sure.\n     SupportedVersion UNDER_CONSTRUCTION = new SupportedVersion() {\n         @Override\n-        public boolean supports(TransportVersion version) {\n+        public boolean supportedOn(TransportVersion version) {\n             return Build.current().isSnapshot();\n         }\n \n@@ -73,10 +73,10 @@ public String toString() {\n      *     continue to work. Otherwise, we'd have to update bwc tests to skip older versions based\n      *     on a capability check, which can be error-prone and risks turning off an unrelated bwc test.\n      */\n-    static SupportedVersion supportedOn(TransportVersion supportedVersion) {\n+    static SupportedVersion supportedSince(TransportVersion supportedVersion) {\n         return new SupportedVersion() {\n             @Override\n-            public boolean supports(TransportVersion version) {\n+            public boolean supportedOn(TransportVersion version) {\n                 return version.supports(supportedVersion) || Build.current().isSnapshot();\n             }\n \n",
  "additions": 20,
  "deletions": 16,
  "changed_files": 2,
  "url": "https://github.com/elastic/elasticsearch/pull/137044",
  "mined_at": "2025-10-25T13:42:27.524379"
}
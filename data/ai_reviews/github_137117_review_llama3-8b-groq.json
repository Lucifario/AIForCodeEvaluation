{
  "source_item_id": 137117,
  "source_type": "github",
  "generator_model_id": "llama3-8b-groq",
  "generation_timestamp": "2025-10-26T13:39:10.586469",
  "input_code_language": "java",
  "input_code_snippet": "/*\n * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n * or more contributor license agreements. Licensed under the \"Elastic License\n * 2.0\", the \"GNU Affero General Public License v3.0 only\", and the \"Server Side\n * Public License v 1\"; you may not use this file except in compliance with, at\n * your election, the \"Elastic License 2.0\", the \"GNU Affero General Public\n * License v3.0 only\", or the \"Server Side Public License, v 1\".\n */\n\npackage org.elasticsearch.cluster.metadata;\n\nimport org.apache.logging.log4j.Level;\nimport org.apache.logging.log4j.LogManager;\nimport org.apache.logging.log4j.Logger;\nimport org.elasticsearch.ResourceAlreadyExistsException;\nimport org.elasticsearch.TransportVersion;\nimport org.elasticsearch.TransportVersions;\nimport org.elasticsearch.action.ActionListener;\nimport org.elasticsearch.action.admin.indices.alias.Alias;\nimport org.elasticsearch.action.admin.indices.create.CreateIndexClusterStateUpdateRequest;\nimport org.elasticsearch.action.admin.indices.shrink.ResizeType;\nimport org.elasticsearch.action.support.ActiveShardCount;\nimport org.elasticsearch.action.support.ActiveShardsObserver;\nimport org.elasticsearch.action.support.master.AcknowledgedResponse;\nimport org.elasticsearch.action.support.master.ShardsAcknowledgedResponse;\nimport org.elasticsearch.cluster.AckedClusterStateUpdateTask;\nimport org.elasticsearch.cluster.ClusterState;\nimport org.elasticsearch.cluster.ClusterStateUpdateTask;\nimport org.elasticsearch.cluster.ProjectState;\nimport org.elasticsearch.cluster.block.ClusterBlockLevel;\nimport org.elasticsearch.cluster.block.ClusterBlocks;\nimport org.elasticsearch.cluster.node.DiscoveryNode;\nimport org.elasticsearch.cluster.node.DiscoveryNodes;\nimport org.elasticsearch.cluster.routing.GlobalRoutingTable;\nimport org.elasticsearch.cluster.routing.IndexRoutingTable;\nimport org.elasticsearch.cluster.routing.RoutingTable;\nimport org.elasticsearch.cluster.routing.ShardRouting;\nimport org.elasticsearch.cluster.routing.ShardRoutingRoleStrategy;\nimport org.elasticsearch.cluster.routing.ShardRoutingState;\nimport org.elasticsearch.cluster.routing.allocation.AllocationService;\nimport org.elasticsearch.cluster.routing.allocation.DataTier;\nimport org.elasticsearch.cluster.routing.allocation.allocator.AllocationActionListener;\nimport org.elasticsearch.cluster.service.ClusterService;\nimport org.elasticsearch.common.Priority;\nimport org.elasticsearch.common.Strings;\nimport org.elasticsearch.common.UUIDs;\nimport org.elasticsearch.common.ValidationException;\nimport org.elasticsearch.common.compress.CompressedXContent;\nimport org.elasticsearch.common.logging.DeprecationCategory;\nimport org.elasticsearch.common.logging.DeprecationLogger;\nimport org.elasticsearch.common.settings.IndexScopedSettings;\nimport org.elasticsearch.common.settings.Setting;\nimport org.elasticsearch.common.settings.Settings;\nimport org.elasticsearch.common.xcontent.XContentHelper;\nimport org.elasticsearch.core.FixForMultiProject;\nimport org.elasticsearch.core.Nullable;\nimport org.elasticsearch.core.PathUtils;\nimport org.elasticsearch.core.SuppressForbidden;\nimport org.elasticsearch.core.TimeValue;\nimport org.elasticsearch.env.Environment;\nimport org.elasticsearch.index.Index;\nimport org.elasticsearch.index.IndexMode;\nimport org.elasticsearch.index.IndexModule;\nimport org.elasticsearch.index.IndexNotFoundException;\nimport org.elasticsearch.index.IndexService;\nimport org.elasticsearch.index.IndexSettingProvider;\nimport org.elasticsearch.index.IndexSettingProviders;\nimport org.elasticsearch.index.IndexSettings;\nimport org.elasticsearch.index.IndexSortConfig;\nimport org.elasticsearch.index.IndexVersion;\nimport org.elasticsearch.index.IndexVersions;\nimport org.elasticsearch.index.mapper.DocumentMapper;\nimport org.elasticsearch.index.mapper.MapperService;\nimport org.elasticsearch.index.mapper.MapperService.MergeReason;\nimport org.elasticsearch.index.query.SearchExecutionContext;\nimport org.elasticsearch.indices.IndexCreationException;\nimport org.elasticsearch.indices.IndicesService;\nimport org.elasticsearch.indices.InvalidIndexNameException;\nimport org.elasticsearch.indices.ShardLimitValidator;\nimport org.elasticsearch.indices.SystemIndexDescriptor;\nimport org.elasticsearch.indices.SystemIndices;\nimport org.elasticsearch.threadpool.ThreadPool;\nimport org.elasticsearch.xcontent.NamedXContentRegistry;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.nio.file.Path;\nimport java.time.Instant;\nimport java.util.ArrayList;\nimport java.util.Arrays;\nimport java.util.Collections;\nimport java.util.HashMap;\nimport java.util.HashSet;\nimport java.util.List;\nimport java.util.Locale;\nimport java.util.Map;\nimport java.util.Objects;\nimport java.util.Optional;\nimport java.util.Set;\nimport java.util.concurrent.atomic.AtomicInteger;\nimport java.util.function.BiConsumer;\nimport java.util.function.BiFunction;\nimport java.util.function.Function;\nimport java.util.function.Predicate;\nimport java.util.function.Supplier;\nimport java.util.stream.Collectors;\nimport java.util.stream.IntStream;\n\nimport static java.util.Collections.emptyMap;\nimport static java.util.stream.Collectors.toList;\nimport static org.elasticsearch.cluster.metadata.IndexMetadata.INDEX_NUMBER_OF_REPLICAS_SETTING;\nimport static org.elasticsearch.cluster.metadata.IndexMetadata.INDEX_NUMBER_OF_SHARDS_SETTING;\nimport static org.elasticsearch.cluster.metadata.IndexMetadata.INDEX_SHRINK_INITIAL_RECOVERY_KEY;\nimport static org.elasticsearch.cluster.metadata.IndexMetadata.SETTING_AUTO_EXPAND_REPLICAS;\nimport static org.elasticsearch.cluster.metadata.IndexMetadata.SETTING_CREATION_DATE;\nimport static org.elasticsearch.cluster.metadata.IndexMetadata.SETTING_INDEX_UUID;\nimport static org.elasticsearch.cluster.metadata.IndexMetadata.SETTING_NUMBER_OF_REPLICAS;\nimport static org.elasticsearch.cluster.metadata.IndexMetadata.SETTING_NUMBER_OF_SHARDS;\nimport static org.elasticsearch.cluster.metadata.MetadataIndexTemplateService.resolveSettings;\nimport static org.elasticsearch.index.IndexModule.INDEX_RECOVERY_TYPE_SETTING;\nimport static org.elasticsearch.index.IndexModule.INDEX_STORE_TYPE_SETTING;\n\n/**\n * Service responsible for submitting create index requests\n */\npublic class MetadataCreateIndexService {\n    private static final Logger logger = LogManager.getLogger(MetadataCreateIndexService.class);\n    private static final DeprecationLogger deprecationLogger = DeprecationLogger.getLogger(MetadataCreateIndexService.class);\n\n    public static final int MAX_INDEX_NAME_BYTES = 255;\n\n    /**\n     * Name of the setting used to allow blocking refreshes on newly created indices.\n     */\n    public static final String USE_INDEX_REFRESH_BLOCK_SETTING_NAME = \"stateless.indices.use_refresh_block_upon_index_creation\";\n\n    @FunctionalInterface\n    interface ClusterBlocksTransformer {\n        void apply(\n            ClusterBlocks.Builder clusterBlocks,\n            ProjectId projectId,\n            IndexMetadata indexMetadata,\n            TransportVersion minClusterTransportVersion\n        );\n    }\n\n    private final Settings settings;\n    private final ClusterService clusterService;\n    private final IndicesService indicesService;\n    private final AllocationService allocationService;\n    private final Environment env;\n    private final IndexScopedSettings indexScopedSettings;\n    private final NamedXContentRegistry xContentRegistry;\n    private final SystemIndices systemIndices;\n    private final ShardLimitValidator shardLimitValidator;\n    private final boolean forbidPrivateIndexSettings;\n    private final Set<IndexSettingProvider> indexSettingProviders;\n    private final ThreadPool threadPool;\n    private final ClusterBlocksTransformer blocksTransformerUponIndexCreation;\n\n    public MetadataCreateIndexService(\n        final Settings settings,\n        final ClusterService clusterService,\n        final IndicesService indicesService,\n        final AllocationService allocationService,\n        ",
  "raw_llm_output": "{\n  \"bugs_found\": [\n      {\n         \"explanation\": \"Potential NullPointerException in the constructor of MetadataCreateIndexService. The parameters 'settings', 'clusterService', 'indicesService', 'allocationService', 'env', 'indexScopedSettings', 'xContentRegistry', 'systemIndices', 'shardLimitValidator', 'forbidPrivateIndexSettings', 'indexSettingProviders', and 'threadPool' are not checked for null before being assigned to instance variables.\",\n         \"suggested_fix\": \"Add null checks for each parameter in the constructor of MetadataCreateIndexService.\"\n      },\n      {\n         \"explanation\": \"The 'blocksTransformerUponIndexCreation' parameter in the constructor of MetadataCreateIndexService is not checked for null before being assigned to the instance variable.\",\n         \"suggested_fix\": \"Add a null check for the 'blocksTransformerUponIndexCreation' parameter in the constructor of MetadataCreateIndexService.\"\n      },\n      {\n         \"explanation\": \"The 'settings' instance variable is not checked for null before being used in the 'resolveSettings' method.\",\n         \"suggested_fix\": \"Add a null check for the 'settings' instance variable before calling the 'resolveSettings' method.\"\n      },\n      {\n         \"explanation\": \"The 'indexSettingProviders' instance variable is not checked for null before being used in the 'resolveSettings' method.\",\n         \"suggested_fix\": \"Add a null check for the 'indexSettingProviders' instance variable before calling the 'resolveSettings' method.\"\n      },\n      {\n         \"explanation\": \"The 'indexMetadata' object is not checked for null before being used in the 'apply' method of the 'ClusterBlocksTransformer' interface.\",\n         \"suggested_fix\": \"Add a null check for the 'indexMetadata' object before using it in the 'apply' method of the 'ClusterBlocksTransformer' interface.\"\n      },\n      {\n         \"explanation\": \"The 'projectId' object is not checked for null before being used in the 'apply' method of the 'ClusterBlocksTransformer' interface.\",\n         \"suggested_fix\": \"Add a null check for the 'projectId' object before using it in the 'apply' method of the 'ClusterBlocksTransformer' interface.\"\n      },\n      {\n         \"explanation\": \"The 'minClusterTransportVersion' object is not checked for null before being used in the 'apply' method of the 'ClusterBlocksTransformer' interface.\",\n         \"suggested_fix\": \"Add a null check for the 'minClusterTransportVersion' object before using it in the 'apply' method of the 'ClusterBlocksTransformer' interface.\"\n      },\n      {\n         \"explanation\": \"The 'clusterBlocks' object is not checked for null before being used in the 'apply' method of the 'ClusterBlocksTransformer' interface.\",\n         \"suggested_fix\": \"Add a null check for the 'clusterBlocks' object before using it in the 'apply' method of the 'ClusterBlocksTransformer' interface.\"\n      }\n   ],\n   \"no_bugs_reasoning\": \"No bugs found in the provided code snippet.\"\n}",
  "parsed_llm_output": {
    "bugs_found": [
      {
        "explanation": "Potential NullPointerException in the constructor of MetadataCreateIndexService. The parameters 'settings', 'clusterService', 'indicesService', 'allocationService', 'env', 'indexScopedSettings', 'xContentRegistry', 'systemIndices', 'shardLimitValidator', 'forbidPrivateIndexSettings', 'indexSettingProviders', and 'threadPool' are not checked for null before being assigned to instance variables.",
        "suggested_fix": "Add null checks for each parameter in the constructor of MetadataCreateIndexService."
      },
      {
        "explanation": "The 'blocksTransformerUponIndexCreation' parameter in the constructor of MetadataCreateIndexService is not checked for null before being assigned to the instance variable.",
        "suggested_fix": "Add a null check for the 'blocksTransformerUponIndexCreation' parameter in the constructor of MetadataCreateIndexService."
      },
      {
        "explanation": "The 'settings' instance variable is not checked for null before being used in the 'resolveSettings' method.",
        "suggested_fix": "Add a null check for the 'settings' instance variable before calling the 'resolveSettings' method."
      },
      {
        "explanation": "The 'indexSettingProviders' instance variable is not checked for null before being used in the 'resolveSettings' method.",
        "suggested_fix": "Add a null check for the 'indexSettingProviders' instance variable before calling the 'resolveSettings' method."
      },
      {
        "explanation": "The 'indexMetadata' object is not checked for null before being used in the 'apply' method of the 'ClusterBlocksTransformer' interface.",
        "suggested_fix": "Add a null check for the 'indexMetadata' object before using it in the 'apply' method of the 'ClusterBlocksTransformer' interface."
      },
      {
        "explanation": "The 'projectId' object is not checked for null before being used in the 'apply' method of the 'ClusterBlocksTransformer' interface.",
        "suggested_fix": "Add a null check for the 'projectId' object before using it in the 'apply' method of the 'ClusterBlocksTransformer' interface."
      },
      {
        "explanation": "The 'minClusterTransportVersion' object is not checked for null before being used in the 'apply' method of the 'ClusterBlocksTransformer' interface.",
        "suggested_fix": "Add a null check for the 'minClusterTransportVersion' object before using it in the 'apply' method of the 'ClusterBlocksTransformer' interface."
      },
      {
        "explanation": "The 'clusterBlocks' object is not checked for null before being used in the 'apply' method of the 'ClusterBlocksTransformer' interface.",
        "suggested_fix": "Add a null check for the 'clusterBlocks' object before using it in the 'apply' method of the 'ClusterBlocksTransformer' interface."
      }
    ],
    "no_bugs_reasoning": "No bugs found in the provided code snippet."
  },
  "error": null
}
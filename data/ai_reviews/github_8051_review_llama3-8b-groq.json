{
  "source_item_id": 8051,
  "source_type": "github",
  "generator_model_id": "llama3-8b-groq",
  "generation_timestamp": "2025-10-26T13:53:00.171634",
  "input_code_language": "java",
  "input_code_snippet": "/*\n * Copyright (C) 2007 The Guava Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\npackage com.google.common.collect;\n\nimport static com.google.common.base.Preconditions.checkArgument;\nimport static com.google.common.base.Preconditions.checkNotNull;\nimport static com.google.common.collect.CollectPreconditions.checkNonnegative;\nimport static com.google.common.collect.ImmutableList.asImmutableList;\nimport static com.google.common.collect.ObjectArrays.checkElementNotNull;\nimport static java.lang.Math.max;\nimport static java.util.Objects.requireNonNull;\n\nimport com.google.common.annotations.GwtCompatible;\nimport com.google.common.annotations.GwtIncompatible;\nimport com.google.common.annotations.J2ktIncompatible;\nimport com.google.common.annotations.VisibleForTesting;\nimport com.google.common.primitives.Ints;\nimport com.google.errorprone.annotations.CanIgnoreReturnValue;\nimport com.google.errorprone.annotations.concurrent.LazyInit;\nimport com.google.j2objc.annotations.RetainedWith;\nimport java.io.InvalidObjectException;\nimport java.io.ObjectInputStream;\nimport java.io.Serializable;\nimport java.util.Arrays;\nimport java.util.Collection;\nimport java.util.Collections;\nimport java.util.Iterator;\nimport java.util.Set;\nimport java.util.SortedSet;\nimport java.util.stream.Collector;\nimport org.jspecify.annotations.Nullable;\n\n/**\n * A {@link Set} whose contents will never change, with many other important properties detailed at\n * {@link ImmutableCollection}.\n *\n * @since 2.0\n */\n@GwtCompatible\n@SuppressWarnings(\"serial\") // we're overriding default serialization\npublic abstract class ImmutableSet<E> extends ImmutableCollection<E> implements Set<E> {\n  // @IgnoreJRERequirement is not necessary because this compiles down to a constant.\n  // (which is fortunate because Animal Sniffer doesn't look for @IgnoreJRERequirement on fields)\n\n  /**\n   * Returns a {@code Collector} that accumulates the input elements into a new {@code\n   * ImmutableSet}. Elements appear in the resulting set in the encounter order of the stream; if\n   * the stream contains duplicates (according to {@link Object#equals(Object)}), only the first\n   * duplicate in encounter order will appear in the result.\n   *\n   * @since 33.2.0 (available since 21.0 in guava-jre)\n   */\n  @IgnoreJRERequirement // Users will use this only if they're already using streams.\n  public static <E> Collector<E, ?, ImmutableSet<E>> toImmutableSet() {\n    return CollectCollectors.toImmutableSet();\n  }\n\n  /**\n   * Returns the empty immutable set. Preferred over {@link Collections#emptySet} for code\n   * consistency, and because the return type conveys the immutability guarantee.\n   *\n   * <p><b>Performance note:</b> the instance returned is a singleton.\n   */\n  @SuppressWarnings({\"unchecked\"}) // fully variant implementation (never actually produces any Es)\n  public static <E> ImmutableSet<E> of() {\n    return (ImmutableSet<E>) RegularImmutableSet.EMPTY;\n  }\n\n  /**\n   * Returns an immutable set containing the given element. Preferred over {@link\n   * Collections#singleton} for code consistency, {@code null} rejection, and because the return\n   * type conveys the immutability guarantee.\n   */\n  public static <E> ImmutableSet<E> of(E e1) {\n    return new SingletonImmutableSet<>(e1);\n  }\n\n  /**\n   * Returns an immutable set containing the given elements, minus duplicates, in the order each was\n   * first specified. That is, if multiple elements are {@linkplain Object#equals equal}, all except\n   * the first are ignored.\n   */\n  public static <E> ImmutableSet<E> of(E e1, E e2) {\n    return construct(2, e1, e2);\n  }\n\n  /**\n   * Returns an immutable set containing the given elements, minus duplicates, in the order each was\n   * first specified. That is, if multiple elements are {@linkplain Object#equals equal}, all except\n   * the first are ignored.\n   */\n  public static <E> ImmutableSet<E> of(E e1, E e2, E e3) {\n    return construct(3, e1, e2, e3);\n  }\n\n  /**\n   * Returns an immutable set containing the given elements, minus duplicates, in the order each was\n   * first specified. That is, if multiple elements are {@linkplain Object#equals equal}, all except\n   * the first are ignored.\n   */\n  public static <E> ImmutableSet<E> of(E e1, E e2, E e3, E e4) {\n    return construct(4, e1, e2, e3, e4);\n  }\n\n  /**\n   * Returns an immutable set containing the given elements, minus duplicates, in the order each was\n   * first specified. That is, if multiple elements are {@linkplain Object#equals equal}, all except\n   * the first are ignored.\n   */\n  public static <E> ImmutableSet<E> of(E e1, E e2, E e3, E e4, E e5) {\n    return construct(5, e1, e2, e3, e4, e5);\n  }\n\n  /**\n   * Returns an immutable set containing the given elements, minus duplicates, in the order each was\n   * first specified. That is, if multiple elements are {@linkplain Object#equals equal}, all except\n   * the first are ignored.\n   *\n   * <p>The array {@code others} must not be longer than {@code Integer.MAX_VALUE - 6}.\n   *\n   * @since 3.0 (source-compatible since 2.0)\n   */\n  @SafeVarargs // For Eclipse. For internal javac we have disabled this pointless type of warning.\n  public static <E> ImmutableSet<E> of(E e1, E e2, E e3, E e4, E e5, E e6, E... others) {\n    checkArgument(\n        others.length <= Integer.MAX_VALUE - 6, \"the total number of elements must fit in an int\");\n    final int paramCount = 6;\n    Object[] elements = new Object[paramCount + others.length];\n    elements[0] = e1;\n    elements[1] = e2;\n    elements[2] = e3;\n    elements[3] = e4;\n    elements[4] = e5;\n    elements[5] = e6;\n    System.arraycopy(others, 0, elements, paramCount, others.length);\n    return construct(elements.length, elements);\n  }\n\n  /**\n   * Constructs an {@code ImmutableSet} from the first {@code n} elements of the specified array. If\n   * {@code k} is the size of the returned {@code ImmutableSet}, then the unique elements of {@code\n   * elements} will be in the first {@code k} positions, and {@code elements[i] == null} for {@code\n   * k <= i < n}.\n   *\n   * <p>After this method returns, {@code elements} will contain no duplicates, but {@code elements}\n   * may be the real array backing the returned set, so do not modify it further.\n   *\n   * <p>{@code elements} may contain only values of type {@code E}.\n   *\n   * @throws NullPointerException if any of the first {@code n} elements of {@code elements} is null\n   */\n  private static <E> ImmutableSet<E> construct(int n, @Nullable Object... elements) {\n    switch (n) {\n      case 0:\n        return of();\n      case 1:\n        @SuppressWarnings(\"unchecked\") // safe; elements contains only E's\n        // requireNonNull is safe because the first `n` elements are non-null.\n        E elem = (E) requireNonNull(elements[0]);\n        return of(elem);\n      default:\n        // continue below to handle the general case\n    }\n    int tableSize = chooseTableSize(n);\n    Object[] table = new Object[tableSize];\n    int mask = tableSize - 1;\n    int hashCode = 0;\n    int uniques = 0;\n    for (int i = 0; i < n; i++) {\n      Object element = checkElementNotNull(elements[i], i);\n      int hash = element.hashCode();\n      for (int j = Hashing.smear(hash); ; j++) {\n        int index = j & mask;\n        Object value = table[index];\n        if (value == null) {\n          // Came to an empty slot. Put the element here.\n          elements[uniques++] = element;\n          table[index] = element;\n          hashCode += hash;\n          break;\n        }",
  "raw_llm_output": "{\n  \"bugs_found\": [\n      {\n         \"explanation\": \"The method 'construct' does not handle the case where 'n' is greater than 1 and the first element is null. It should throw a NullPointerException.\",\n         \"suggested_fix\": \"if (n > 1 && elements[0] == null) { throw new NullPointerException(); }\"\n      },\n      {\n         \"explanation\": \"The method 'construct' does not handle the case where 'n' is greater than 1 and the first element is not an instance of 'E'. It should throw a ClassCastException.\",\n         \"suggested_fix\": \"if (n > 1 && !(elements[0] instanceof E)) { throw new ClassCastException(); }\"\n      },\n      {\n         \"explanation\": \"The method 'of' does not check if the 'others' array is null before calling 'System.arraycopy'. It should check for null before calling the method.\",\n         \"suggested_fix\": \"if (others == null) { throw new NullPointerException(); } else { System.arraycopy(others, 0, elements, paramCount, others.length); }\"\n      }\n   ],\n   \"no_bugs_reasoning\": \"No bugs found in the given code snippet.\"\n}",
  "parsed_llm_output": {
    "bugs_found": [
      {
        "explanation": "The method 'construct' does not handle the case where 'n' is greater than 1 and the first element is null. It should throw a NullPointerException.",
        "suggested_fix": "if (n > 1 && elements[0] == null) { throw new NullPointerException(); }"
      },
      {
        "explanation": "The method 'construct' does not handle the case where 'n' is greater than 1 and the first element is not an instance of 'E'. It should throw a ClassCastException.",
        "suggested_fix": "if (n > 1 && !(elements[0] instanceof E)) { throw new ClassCastException(); }"
      },
      {
        "explanation": "The method 'of' does not check if the 'others' array is null before calling 'System.arraycopy'. It should check for null before calling the method.",
        "suggested_fix": "if (others == null) { throw new NullPointerException(); } else { System.arraycopy(others, 0, elements, paramCount, others.length); }"
      }
    ],
    "no_bugs_reasoning": "No bugs found in the given code snippet."
  },
  "error": null
}
{
  "source_item_id": 136810,
  "source_type": "github",
  "generator_model_id": "llama3-8b-groq",
  "generation_timestamp": "2025-10-26T13:34:02.219186",
  "input_code_language": "java",
  "input_code_snippet": "/*\n * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n * or more contributor license agreements. Licensed under the \"Elastic License\n * 2.0\", the \"GNU Affero General Public License v3.0 only\", and the \"Server Side\n * Public License v 1\"; you may not use this file except in compliance with, at\n * your election, the \"Elastic License 2.0\", the \"GNU Affero General Public\n * License v3.0 only\", or the \"Server Side Public License, v 1\".\n */\npackage org.elasticsearch.common.settings;\n\nimport org.elasticsearch.cluster.metadata.DataStreamFailureStoreDefinition;\nimport org.elasticsearch.cluster.metadata.IndexMetadata;\nimport org.elasticsearch.cluster.metadata.MetadataIndexStateService;\nimport org.elasticsearch.cluster.routing.UnassignedInfo;\nimport org.elasticsearch.cluster.routing.allocation.DataTier;\nimport org.elasticsearch.cluster.routing.allocation.ExistingShardsAllocator;\nimport org.elasticsearch.cluster.routing.allocation.decider.DiskThresholdDecider;\nimport org.elasticsearch.cluster.routing.allocation.decider.EnableAllocationDecider;\nimport org.elasticsearch.cluster.routing.allocation.decider.MaxRetryAllocationDecider;\nimport org.elasticsearch.cluster.routing.allocation.decider.ShardsLimitAllocationDecider;\nimport org.elasticsearch.common.logging.Loggers;\nimport org.elasticsearch.common.settings.Setting.Property;\nimport org.elasticsearch.index.IndexModule;\nimport org.elasticsearch.index.IndexSettings;\nimport org.elasticsearch.index.IndexSortConfig;\nimport org.elasticsearch.index.IndexVersion;\nimport org.elasticsearch.index.IndexVersions;\nimport org.elasticsearch.index.IndexingSlowLog;\nimport org.elasticsearch.index.MergePolicyConfig;\nimport org.elasticsearch.index.MergeSchedulerConfig;\nimport org.elasticsearch.index.SearchSlowLog;\nimport org.elasticsearch.index.cache.bitset.BitsetFilterCache;\nimport org.elasticsearch.index.engine.EngineConfig;\nimport org.elasticsearch.index.fielddata.IndexFieldDataService;\nimport org.elasticsearch.index.mapper.FieldMapper;\nimport org.elasticsearch.index.mapper.IgnoredSourceFieldMapper;\nimport org.elasticsearch.index.mapper.InferenceMetadataFieldsMapper;\nimport org.elasticsearch.index.mapper.MapperService;\nimport org.elasticsearch.index.mapper.vectors.DenseVectorFieldMapper;\nimport org.elasticsearch.index.similarity.SimilarityService;\nimport org.elasticsearch.index.store.FsDirectoryFactory;\nimport org.elasticsearch.index.store.Store;\nimport org.elasticsearch.indices.IndicesRequestCache;\nimport org.elasticsearch.indices.ShardLimitValidator;\n\nimport java.util.Arrays;\nimport java.util.Collections;\nimport java.util.HashSet;\nimport java.util.Map;\nimport java.util.Set;\n\n/**\n * Encapsulates all valid index level settings.\n * @see Property#IndexScope\n */\npublic final class IndexScopedSettings extends AbstractScopedSettings {\n\n    public static final Set<Setting<?>> BUILT_IN_INDEX_SETTINGS;\n\n    static {\n        Set<Setting<?>> settings = new HashSet<>(\n            Arrays.asList(\n                MaxRetryAllocationDecider.SETTING_ALLOCATION_MAX_RETRY,\n                MergeSchedulerConfig.AUTO_THROTTLE_SETTING,\n                MergeSchedulerConfig.MAX_MERGE_COUNT_SETTING,\n                MergeSchedulerConfig.MAX_THREAD_COUNT_SETTING,\n                IndexMetadata.SETTING_INDEX_VERSION_CREATED,\n                IndexMetadata.SETTING_INDEX_VERSION_COMPATIBILITY,\n                IndexMetadata.INDEX_ROUTING_EXCLUDE_GROUP_SETTING,\n                IndexMetadata.INDEX_ROUTING_INCLUDE_GROUP_SETTING,\n                IndexMetadata.INDEX_ROUTING_REQUIRE_GROUP_SETTING,\n                IndexMetadata.INDEX_AUTO_EXPAND_REPLICAS_SETTING,\n                IndexMetadata.INDEX_NUMBER_OF_REPLICAS_SETTING,\n                IndexMetadata.INDEX_NUMBER_OF_SHARDS_SETTING,\n                IndexMetadata.INDEX_ROUTING_PARTITION_SIZE_SETTING,\n                IndexMetadata.INDEX_NUMBER_OF_ROUTING_SHARDS_SETTING,\n                IndexMetadata.INDEX_READ_ONLY_SETTING,\n                IndexMetadata.INDEX_BLOCKS_READ_SETTING,\n                IndexMetadata.INDEX_BLOCKS_WRITE_SETTING,\n                IndexMetadata.INDEX_BLOCKS_METADATA_SETTING,\n                IndexMetadata.INDEX_BLOCKS_READ_ONLY_ALLOW_DELETE_SETTING,\n                IndexMetadata.INDEX_PRIORITY_SETTING,\n                IndexMetadata.INDEX_DATA_PATH_SETTING,\n                IndexMetadata.INDEX_HIDDEN_SETTING,\n                IndexMetadata.INDEX_FORMAT_SETTING,\n                IndexMetadata.INDEX_DOWNSAMPLE_SOURCE_NAME,\n                IndexMetadata.INDEX_DOWNSAMPLE_SOURCE_UUID,\n                IndexMetadata.INDEX_DOWNSAMPLE_ORIGIN_NAME,\n                IndexMetadata.INDEX_DOWNSAMPLE_ORIGIN_UUID,\n                IndexMetadata.INDEX_DOWNSAMPLE_STATUS,\n                IndexMetadata.INDEX_DOWNSAMPLE_INTERVAL,\n                IndexMetadata.INDEX_DOWNSAMPLE_METHOD,\n                SearchSlowLog.INDEX_SEARCH_SLOWLOG_THRESHOLD_FETCH_DEBUG_SETTING,\n                SearchSlowLog.INDEX_SEARCH_SLOWLOG_THRESHOLD_FETCH_WARN_SETTING,\n                SearchSlowLog.INDEX_SEARCH_SLOWLOG_THRESHOLD_FETCH_INFO_SETTING,\n                SearchSlowLog.INDEX_SEARCH_SLOWLOG_THRESHOLD_FETCH_TRACE_SETTING,\n                SearchSlowLog.INDEX_SEARCH_SLOWLOG_THRESHOLD_QUERY_WARN_SETTING,\n                SearchSlowLog.INDEX_SEARCH_SLOWLOG_THRESHOLD_QUERY_DEBUG_SETTING,\n                SearchSlowLog.INDEX_SEARCH_SLOWLOG_THRESHOLD_QUERY_INFO_SETTING,\n                SearchSlowLog.INDEX_SEARCH_SLOWLOG_THRESHOLD_QUERY_TRACE_SETTING,\n                SearchSlowLog.INDEX_SEARCH_SLOWLOG_INCLUDE_USER_SETTING,\n                IndexingSlowLog.INDEX_INDEXING_SLOWLOG_THRESHOLD_INDEX_WARN_SETTING,\n                IndexingSlowLog.INDEX_INDEXING_SLOWLOG_THRESHOLD_INDEX_DEBUG_SETTING,\n                IndexingSlowLog.INDEX_INDEXING_SLOWLOG_THRESHOLD_INDEX_INFO_SETTING,\n                IndexingSlowLog.INDEX_INDEXING_SLOWLOG_THRESHOLD_INDEX_TRACE_SETTING,\n                IndexingSlowLog.INDEX_INDEXING_SLOWLOG_REFORMAT_SETTING,\n                IndexingSlowLog.INDEX_INDEXING_SLOWLOG_MAX_SOURCE_CHARS_TO_LOG_SETTING,\n                IndexingSlowLog.INDEX_INDEXING_SLOWLOG_INCLUDE_USER_SETTING,\n                MergePolicyConfig.INDEX_COMPOUND_FORMAT_SETTING,\n                MergePolicyConfig.INDEX_MERGE_POLICY_TYPE_SETTING,\n                MergePolicyConfig.INDEX_MERGE_POLICY_DELETES_PCT_ALLOWED_SETTING,\n                MergePolicyConfig.INDEX_MERGE_POLICY_EXPUNGE_DELETES_ALLOWED_SETTING,\n                MergePolicyConfig.INDEX_MERGE_POLICY_FLOOR_SEGMENT_SETTING,\n                MergePolicyConfig.INDEX_MERGE_POLICY_MAX_MERGE_AT_ONCE_SETTING,\n                MergePolicyConfig.INDEX_MERGE_POLICY_MAX_MERGE_AT_ONCE_EXPLICIT_SETTING,\n                MergePolicyConfig.INDEX_MERGE_POLICY_MAX_MERGED_SEGMENT_SETTING,\n                MergePolicyConfig.INDEX_MERGE_POLICY_SEGMENTS_PER_TIER_SETTING,\n                MergePolicyConfig.INDEX_MERGE_POLICY_MERGE_FACTOR_SETTING,\n                IndexSortConfig.INDEX_SORT_FIELD_SETTING,\n                IndexSortConfig.INDEX_SORT_ORDER_SETTING,\n                IndexSortConfig.INDEX_SORT_MISSING_SETTING,\n                IndexSortConfig.INDEX_SORT_MODE_SETTING,\n                IndexSettings.INDEX_TRANSLOG_DURABILITY_SETTING,\n                IndexSettings.INDEX_WARMER_ENABLED_SETTING,\n                IndexSettings.INDEX_REFRESH_INTERVAL_SETTING,\n                IndexSettings.INDEX_FAST_REFRESH_SETTING,\n                IndexSettings.MAX_RESULT_WINDOW_SETTING,\n                IndexSettings.MAX_INNER_RESULT_WINDOW_SETTING,\n                IndexSettings.MAX_TOKEN_COUNT_SETTING,\n                IndexSettings.MAX_DOCVALUE_FIELDS_SEARCH_SETTING,\n                IndexSettings.MAX_SCRIPT_FIELDS_SETTING,\n                IndexSettings.MAX_NGRAM_DIFF_SETTING,\n                IndexSettings.MAX_SHINGLE_DIFF_SETTING,\n                IndexSettings.MAX_RESCORE_WINDOW_SETTING,\n                IndexSettings.MAX_ANALYZED_OFFSET_SETTING,\n                IndexSettings.WEIGHT_MATCHES_MODE_ENABLED_SETTING,\n                In",
  "raw_llm_output": "{\n  \"bugs_found\": [\n      {\n         \"explanation\": \"The static block is not thread-safe. It's using a HashSet to store settings, but it's not synchronized. This can lead to concurrent modification exceptions when multiple threads try to access the settings.\",\n         \"suggested_fix\": \"Use a thread-safe collection like CopyOnWriteArraySet to store the settings.\"\n      },\n      {\n         \"explanation\": \"The IndexScopedSettings class is not thread-safe. It's not synchronized, and it's not immutable. This can lead to unexpected behavior when multiple threads try to access the settings.\",\n         \"suggested_fix\": \"Make the class immutable by removing the static block and using a thread-safe collection. Alternatively, synchronize the class using a lock or a synchronized block.\"\n      }\n   ],\n   \"no_bugs_reasoning\": \"\"\n}",
  "parsed_llm_output": {
    "bugs_found": [
      {
        "explanation": "The static block is not thread-safe. It's using a HashSet to store settings, but it's not synchronized. This can lead to concurrent modification exceptions when multiple threads try to access the settings.",
        "suggested_fix": "Use a thread-safe collection like CopyOnWriteArraySet to store the settings."
      },
      {
        "explanation": "The IndexScopedSettings class is not thread-safe. It's not synchronized, and it's not immutable. This can lead to unexpected behavior when multiple threads try to access the settings.",
        "suggested_fix": "Make the class immutable by removing the static block and using a thread-safe collection. Alternatively, synchronize the class using a lock or a synchronized block."
      }
    ],
    "no_bugs_reasoning": ""
  },
  "error": null
}
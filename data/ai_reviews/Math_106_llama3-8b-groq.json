{"sample_id": "Math_106", "model": "llama3-8b-groq", "code_context": "/*\n * Copyright 2005 The Apache Software Foundation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage org.apache.commons.math.fraction;\n\nimport java.text.FieldPosition;\nimport java.text.NumberFormat;\nimport java.text.ParsePosition;\n\nimport org.apache.commons.math.util.MathUtils;\n\n/**\n * Formats a Fraction number in proper format.  The number format for each of\n * the whole number, numerator and, denominator can be configured.\n * <p>\n * Minus signs are only allowed in the whole number part - i.e.,\n * \"-3 1/2\" is legitimate and denotes -7/2, but \"-3 -1/2\" is invalid and\n * will result in a <code>ParseException</code>.\n * \n * @since 1.1\n * @version $Revision$ $Date$\n */\npublic class ProperFractionFormat extends FractionFormat {\n    \n    /** Serializable version identifier */\n    private static final long serialVersionUID = -6337346779577272307L;\n    \n    /** The format used for the whole number. */\n    private NumberFormat wholeFormat;\n\n    /**\n     * Create a proper formatting instance with the default number format for\n     * the whole, numerator, and denominator.  \n     */\n    public ProperFractionFormat() {\n        this(getDefaultNumberFormat());\n    }\n    \n    /**\n     * Create a proper formatting instance with a custom number format for the\n     * whole, numerator, and denominator.\n     * @param format the custom format for the whole, numerator, and\n     *        denominator.\n     */\n    public ProperFractionFormat(NumberFormat format) {\n        this(format, (NumberFormat)format.clone(), (NumberFormat)format.clone());\n    }\n    \n    /**\n     * Create a proper formatting instance with a custom number format for each\n     * of the whole, numerator, and denominator.\n     * @param wholeFormat the custom format for the whole.\n     * @param numeratorFormat the custom format for the numerator.\n     * @param denominatorFormat the custom format for the denominator.\n     */\n    public ProperFractionFormat(NumberFormat wholeFormat,\n            NumberFormat numeratorFormat,\n            NumberFormat denominatorFormat)\n    {\n        super(numeratorFormat, denominatorFormat);\n        setWholeFormat(wholeFormat);\n    }\n    \n    /**\n     * Formats a {@link Fraction} object to produce a string.  The fraction\n     * is output in proper format.\n     *\n     * @param fraction the object to format.\n     * @param toAppendTo where the text is to be appended\n     * @param pos On input: an alignment field, if desired. On output: the\n     *            offsets of the alignment field\n     * @return the value passed in as toAppendTo.\n     */\n    public StringBuffer format(Fraction fraction, StringBuffer toAppendTo,\n            FieldPosition pos) {\n        \n        pos.setBeginIndex(0);\n        pos.setEndIndex(0);\n\n        int num = fraction.getNumerator();\n        int den = fraction.getDenominator();\n        int whole = num / den;\n        num = num % den;\n        \n        if (whole != 0) {\n            getWholeFormat().format(whole, toAppendTo, pos);\n            toAppendTo.append(' ');\n            num = Math.abs(num);\n        }\n        getNumeratorFormat().format(num, toAppendTo, pos);\n        toAppendTo.append(\" / \");\n        getDenominatorFormat().format(den, toAppendTo,\n            pos);\n        \n        return toAppendTo;\n    }\n\n    /**\n     * Access the whole format.\n     * @return the whole format.\n     */\n    public NumberFormat getWholeFormat() {\n        return wholeFormat;\n    }\n    \n    /**\n     * Parses a string to produce a {@link Fraction} object.  This method\n     * expects the string to be formatted as a proper fraction.\n     * <p>\n     * Minus signs are only allowed in the whole number part - i.e.,\n     * \"-3 1/2\" is legitimate and denotes -7/2, but \"-3 -1/2\" is invalid and\n     * will result in a <code>ParseException</code>.\n     * \n     * @param source the string to parse\n     * @param pos input/ouput parsing parameter.\n     * @return the parsed {@link Fraction} object.\n     */\n    public Fraction parse(String source, ParsePosition pos) {\n        // try to parse improper fraction\n        Fraction ret = super.parse(source, pos);\n        if (ret != null) {\n            return ret;\n        }\n        \n        int initialIndex = pos.getIndex();\n\n        // parse whitespace\n        parseAndIgnoreWhitespace(source, pos);\n\n        // parse whole\n        Number whole = getWholeFormat().parse(source, pos);\n        if (whole == null) {\n            // invalid integer number\n            // set index back to initial, error index should already be set\n            // character examined.\n            pos.setIndex(initialIndex);\n            return null;\n        }\n\n        // parse whitespace\n        parseAndIgnoreWhitespace(source, pos);\n        \n        // parse numerator\n        Number num = getNumeratorFormat().parse(source, pos);\n        if (num == null) {\n            // invalid integer number\n            // set index back to initial, error index should already be set\n            // character examined.\n            pos.setIndex(initialIndex);\n            return null;\n        }\n        \n            // minus signs should be leading, invalid expression\n\n        // parse '/'\n        int startIndex = pos.getIndex();\n        char c = parseNextCharacter(source, pos);\n        switch (c) {\n        case 0 :\n            // no '/'\n            // return num as a fraction\n            return new Fraction(num.intValue(), 1);\n        case '/' :\n            // found '/', continue parsing denominator\n            break;\n        default :\n            // invalid '/'\n            // set index back to initial, error index should be the last\n            // character examined.\n            pos.setIndex(initialIndex);\n            pos.setErrorIndex(startIndex);\n            return null;\n        }\n\n        // parse whitespace\n        parseAndIgnoreWhitespace(source, pos);\n\n        // parse denominator\n        Number den = getDenominatorFormat().parse(source, pos);\n        if (den == null) {\n            // invalid integer number\n            // set index back to initial, error index should already be set\n            // character examined.\n            pos.setIndex(initialIndex);\n            return null;\n        }\n        \n            // minus signs must be leading, invalid\n\n        int w = whole.intValue();\n        int n = num.intValue();\n        int d = den.intValue();\n        return new Fraction(((Math.abs(w) * d) + n) * MathUtils.sign(w), d);\n    }\n    \n    /**\n     * Modify the whole format.\n     * @param format The new whole format value.\n     * @throws IllegalArgumentException if <code>format</code> is\n     *         <code>null</code>.\n     */\n    public void setWholeFormat(NumberFormat format) {\n        if (format == null) {\n            throw new IllegalArgumentException(\n                \"whole format can not be null.\");\n        }\n        this.wholeFormat = format;\n    }\n}\n", "review": {"response": "{\n  \"bugs\": [\n      {\n         \"code\": \"Missing 'break' statement in switch case\",\n         \"line\": 173,\n         \"message\": \"Missing break statement in switch case\"\n      },\n      {\n         \"code\": \"Potential NullPointerException in parse method\",\n         \"line\": 191,\n         \"message\": \"parseAndIgnoreWhitespace method may return null\"\n      },\n      {\n         \"code\": \"Potential NullPointerException in parse method\",\n         \"line\": 199,\n         \"message\": \"getWholeFormat().parse method may return null\"\n      },\n      {\n         \"code\": \"Potential NullPointerException in parse method\",\n         \"line\": 207,\n         \"message\": \"getNumeratorFormat().parse method may return null\"\n      },\n      {\n         \"code\": \"Potential IndexOutOfBoundsException in parse method\",\n         \"line\": 173,\n         \"message\": \"startIndex variable may be out of bounds\"\n      }\n   ]\n}"}}